<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>聆风的博客站点</title>
  
  <subtitle>与其临渊羡鱼，不如退而结网</subtitle>
  <link href="https://clarklu.com/atom.xml" rel="self"/>
  
  <link href="https://clarklu.com/"/>
  <updated>2025-11-20T09:15:08.171Z</updated>
  <id>https://clarklu.com/</id>
  
  <author>
    <name>Clark Lu</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hello World</title>
    <link href="https://clarklu.com/p/4a17b156.html"/>
    <id>https://clarklu.com/p/4a17b156.html</id>
    <published>2025-11-20T08:45:17.173Z</published>
    <updated>2025-11-20T09:15:08.171Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt;</summary>
        
      
    
    
    
    
  </entry>
  
  <entry>
    <title>spalsh，单独使用（不使用scrapy框架），如何设置Proxy IP </title>
    <link href="https://clarklu.com/p/79c3476.html"/>
    <id>https://clarklu.com/p/79c3476.html</id>
    <published>2022-10-13T05:36:37.000Z</published>
    <updated>2025-11-20T09:43:36.464Z</updated>
    
    <content type="html"><![CDATA[<h1 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h1><p>有些场景，为了方便、高效，需要脱离scrapy框架使用spalsh</p><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><p>代理：隧道代理为佳</p><p>在宿主机上找个位置，新建文件<code>/root/splash/proxy-files/cip.ini</code> 注意：区别于官方文档，<code>ini</code>应该为小写</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[proxy]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">; required</span></span><br><span class="line"><span class="attr">host</span>=你的配置</span><br><span class="line"><span class="attr">port</span>=你的配置</span><br><span class="line"></span><br><span class="line"><span class="comment">; optional, default is no auth</span></span><br><span class="line"><span class="attr">username</span>=你的配置</span><br><span class="line"><span class="attr">password</span>=你的配置</span><br><span class="line"></span><br><span class="line"><span class="comment">; optional, default is HTTP. Allowed values are HTTP and SOCKS5</span></span><br><span class="line"><span class="attr">type</span>=HTTP</span><br><span class="line"></span><br><span class="line"><span class="section">[rules]</span></span><br><span class="line"><span class="comment">; optional, default &quot;.*&quot;</span></span><br><span class="line"><span class="attr">whitelist</span>=</span><br><span class="line">    .*cip.cc.*</span><br><span class="line"></span><br><span class="line"><span class="comment">; optional, default is no blacklist</span></span><br><span class="line"><span class="attr">blacklist</span>=</span><br><span class="line">    .*.js.*</span><br><span class="line">    .*.css.*</span><br><span class="line">    .*.png</span><br></pre></td></tr></table></figure><h1 id="docker启动spalsh"><a href="#docker启动spalsh" class="headerlink" title="docker启动spalsh"></a>docker启动spalsh</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@host proxy-files]# docker run -p 8050:8050 -v /root/splash/proxy-files:/etc/splash/proxy-profiles scrapinghub/splash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">后台启动</span></span><br><span class="line">docker run -d -p 8050:8050 --restart=always -v /root/splash/proxy-files:/etc/splash/proxy-profiles scrapinghub/splash</span><br></pre></td></tr></table></figure><p>启动后日志：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2022-10-13 04:22:24+0000 [-] Log opened.</span><br><span class="line">2022-10-13 04:22:24.608906 [-] Xvfb is started: [&#x27;Xvfb&#x27;, &#x27;:322410884&#x27;, &#x27;-screen&#x27;, &#x27;0&#x27;, &#x27;1024x768x24&#x27;, &#x27;-nolisten&#x27;, &#x27;tcp&#x27;]</span><br><span class="line">QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to &#x27;/tmp/runtime-splash&#x27;</span><br><span class="line">2022-10-13 04:22:24.718768 [-] Splash version: 3.5</span><br><span class="line">2022-10-13 04:22:24.774528 [-] Qt 5.14.1, PyQt 5.14.2, WebKit 602.1, Chromium 77.0.3865.129, sip 4.19.22, Twisted 19.7.0, Lua 5.2</span><br><span class="line">2022-10-13 04:22:24.774753 [-] Python 3.6.9 (default, Jul 17 2020, 12:50:27) [GCC 8.4.0]</span><br><span class="line">2022-10-13 04:22:24.774878 [-] Open files limit: 1048576</span><br><span class="line">2022-10-13 04:22:24.774946 [-] Can&#x27;t bump open files limit</span><br><span class="line">2022-10-13 04:22:24.806401 [-] proxy profiles support is enabled, proxy profiles path: /etc/splash/proxy-profiles</span><br><span class="line">2022-10-13 04:22:24.806578 [-] memory cache: enabled, private mode: enabled, js cross-domain access: disabled</span><br><span class="line">2022-10-13 04:22:24.969678 [-] verbosity=1, slots=20, argument_cache_max_entries=500, max-timeout=90.0</span><br><span class="line">2022-10-13 04:22:24.970001 [-] Web UI: enabled, Lua: enabled (sandbox: enabled), Webkit: enabled, Chromium: enabled</span><br><span class="line">2022-10-13 04:22:24.970452 [-] Site starting on 8050</span><br><span class="line">2022-10-13 04:22:24.970553 [-] Starting factory &lt;twisted.web.server.Site object at 0x7f729c0f4550&gt;</span><br><span class="line">2022-10-13 04:22:24.970848 [-] Server listening on http://0.0.0.0:8050</span><br></pre></td></tr></table></figure><p>其中 <code>2022-10-13 04:22:24.806401 [-] proxy profiles support is enabled, proxy profiles path: /etc/splash/proxy-profiles </code>标识代理生效</p><h1 id="使用："><a href="#使用：" class="headerlink" title="使用："></a>使用：</h1><p>访问cip.cc，查看此时的ip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl &#x27;http://10.0.19.90:8050/render.html?url=http://cip.cc&amp;proxy=cip&#x27;</span><br></pre></td></tr></table></figure><p>返回结果</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;pre style=&quot;word-wrap: break-word; white-space: pre-wrap;&quot;&gt;Too Many Request</span><br><span class="line">&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;%</span><br><span class="line">➜  ~ curl &#x27;http://10.0.19.90:8050/render.html?url=http://cip.cc&amp;proxy=cip&#x27;</span><br><span class="line">&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.1//EN&quot; &quot;http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd&quot;&gt;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;head&gt;</span><br><span class="line">&lt;title&gt;IP查询 - 查IP(www.cip.cc)&lt;/title&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;description&quot; content=&quot;查IP(www.cip.cc)网站, 提供免费的IP查询服务,命令行查询IP, 并且支持&#x27;PC网站, 手机网站, 命令行(Windows/UNIX/Linux)&#x27; 三大平台, 是个多平台的IP查询网站, 更新即使, 数据准确是我们的目标&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;keywords&quot; content=&quot;IP, 查IP, IP查询&quot;&gt;</span><br><span class="line">&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">&lt;meta content=&quot;width=device-width,initial-scale=1&quot; name=&quot;viewport&quot;&gt;</span><br><span class="line">&lt;link rel=&quot;icon&quot; href=&quot;data:;base64,=&quot;&gt;</span><br><span class="line"> &lt;link href=&quot;//static.cip.cc/static/styles.min.css?v=15&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line"> &lt;script src=&quot;https://hm.baidu.com/hm.js?6c34da399cbcfbb71d86c72215942759&quot;&gt;&lt;/script&gt;&lt;script type=&quot;text/javascript&quot; src=&quot;//static.cip.cc/static/js.min.js?v=6&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=&quot;wrapper&quot;&gt;</span><br><span class="line">&lt;div class=&quot;page&quot;&gt;</span><br><span class="line">&lt;div class=&quot;logo&quot;&gt;</span><br><span class="line">&lt;h1&gt;</span><br><span class="line">&lt;strong&gt;多平台的命令行IP查询&lt;/strong&gt;</span><br><span class="line">&lt;a href=&quot;//www.cip.cc/&quot; title=&quot;手机, 命令行IP查询&quot;&gt;&lt;img src=&quot;//static.cip.cc/static/img/logo.png?v=2&quot; alt=&quot;手机, 命令行IP查询&quot;&gt;&lt;/a&gt;</span><br><span class="line">&lt;/h1&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;search&quot;&gt;</span><br><span class="line">&lt;form action=&quot;/&quot; onsubmit=&quot;return query();&quot;&gt;</span><br><span class="line">&lt;table&gt;</span><br><span class="line">&lt;tbody&gt;</span><br><span class="line">&lt;tr&gt;</span><br><span class="line">&lt;td style=&quot; width: 75%; &quot;&gt;</span><br><span class="line">&lt;input id=&quot;data-input&quot; placeholder=&quot;请输入要查询的 IP 地址&quot; size=&quot;26&quot; type=&quot;text&quot;&gt;</span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;td&gt;</span><br><span class="line">&lt;input id=&quot;data-submit&quot; type=&quot;submit&quot; class=&quot;kq-button&quot; value=&quot;查询&quot;&gt;</span><br><span class="line">&lt;/td&gt;</span><br><span class="line">&lt;/tr&gt;</span><br><span class="line">&lt;/tbody&gt;</span><br><span class="line">&lt;/table&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div class=&quot;data kq-well&quot;&gt;</span><br><span class="line">&lt;pre&gt;IP: 182.87.15.14</span><br><span class="line">地址: 中国  江西  鹰潭</span><br><span class="line">运营商: 电信</span><br><span class="line"></span><br><span class="line">数据二: 江西省鹰潭市 | 电信</span><br><span class="line"></span><br><span class="line">数据三: 中国江西省鹰潭市 | 电信</span><br><span class="line"></span><br><span class="line">URL: http://www.cip.cc/182.87.15.14</span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure><p>可以看到，ip已经更换</p><h1 id="Python-requests-demo"><a href="#Python-requests-demo" class="headerlink" title="Python requests demo"></a>Python requests demo</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">target_url = <span class="string">&quot;http://cip.cc&quot;</span></span><br><span class="line">url = <span class="string">f&#x27;http://<span class="subst">&#123;你的服务器地址&#125;</span>:8050/render.html?url=<span class="subst">&#123;target_url&#125;</span>&amp;proxy=cip&#x27;</span></span><br><span class="line"></span><br><span class="line">response = requests.get(url)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure><p>一个需求案例：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">import time</span><br><span class="line">import requests</span><br><span class="line">from concurrent.futures import ThreadPoolExecutor</span><br><span class="line">from retrying import retry</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@retry(stop_max_attempt_number=3)</span><br><span class="line">def req_taobao():</span><br><span class="line">    target_url = &quot;https://shop551707528.taobao.com/search.htm?search=y&amp;orderType=hotsell_desc&amp;&amp;pageNo=1&quot;</span><br><span class="line">    url = f&#x27;http://10.0.19.90:8050/render.html?url=&#123;target_url&#125;&amp;proxy=taobao&amp;wait=5&#x27;</span><br><span class="line"></span><br><span class="line">    response = requests.get(url, timeout=5)</span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;开始爬虫&quot;&quot;&quot;</span><br><span class="line">s_time = time.time()</span><br><span class="line">executor = ThreadPoolExecutor(5)</span><br><span class="line">for i in range(10):</span><br><span class="line">    executor.submit(req_taobao)</span><br><span class="line">executor.shutdown()</span><br><span class="line">print(time.time() - s_time)</span><br></pre></td></tr></table></figure><h1 id="相关文档"><a href="#相关文档" class="headerlink" title="相关文档"></a>相关文档</h1><ul><li><a href="https://splash.readthedocs.io/en/stable/api.html#render-html">https://splash.readthedocs.io/en/stable/api.html#render-html</a></li><li><a href="https://splash.readthedocs.io/en/stable/api.html#proxy-profiles">https://splash.readthedocs.io/en/stable/api.html#proxy-profiles</a></li><li><a href="https://splash.readthedocs.io/en/stable/install.html#docker-folder-sharing">https://splash.readthedocs.io/en/stable/install.html#docker-folder-sharing</a></li></ul>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;场景&quot;&gt;&lt;a href=&quot;#场景&quot; class=&quot;headerlink&quot; title=&quot;场景&quot;&gt;&lt;/a&gt;场景&lt;/h1&gt;&lt;p&gt;有些场景，为了方便、高效，需要脱离scrapy框架使用spalsh&lt;/p&gt;
&lt;h1 id=&quot;配置&quot;&gt;&lt;a href=&quot;#配置&quot;</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>selenium 使用代理的方法汇总</title>
    <link href="https://clarklu.com/p/9202ce96.html"/>
    <id>https://clarklu.com/p/9202ce96.html</id>
    <published>2019-10-30T05:59:06.000Z</published>
    <updated>2025-11-20T09:43:36.463Z</updated>
    
    <content type="html"><![CDATA[<p>在docker中启动selenium gird使用扩展，并使用隧道代理，比如阿布云、多贝云、蘑菇代理。how to set proxy with authentication in selenium chromedriver python</p><p>proxy with authentication(账号密码认证代理)不支持chrome headless，但是对docker selenium 或者 selenium gird集群，是支持的。<br>启动selenium docker</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4444:4444 --shm-size=2g -m 800M --memory-swap=800M --name=chrome  --restart=always selenium/standalone-chrome</span><br></pre></td></tr></table></figure><p>一、selenium使用隧道动态代理(会生成本地zip插件文件)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> scrapy.selector <span class="keyword">import</span> Selector</span><br><span class="line"></span><br><span class="line">PROXY_HOST = <span class="string">&#x27;http-dyn.abuyun.com&#x27;</span>  <span class="comment"># rotating proxy or host</span></span><br><span class="line">PROXY_PORT = <span class="number">9020</span>  <span class="comment"># port</span></span><br><span class="line">PROXY_USER = <span class="string">&#x27;&#x27;</span>  <span class="comment"># username</span></span><br><span class="line">PROXY_PASS = <span class="string">&#x27;&#x27;</span>  <span class="comment"># password</span></span><br><span class="line"></span><br><span class="line">REMOTE_SELENIUM = <span class="string">&#x27;111.22.111.11:4444&#x27;</span> <span class="comment"># 远端docker selenium地址</span></span><br><span class="line"></span><br><span class="line">manifest_json = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">    &quot;version&quot;: &quot;1.0.0&quot;,</span></span><br><span class="line"><span class="string">    &quot;manifest_version&quot;: 2,</span></span><br><span class="line"><span class="string">    &quot;name&quot;: &quot;Chrome Proxy&quot;,</span></span><br><span class="line"><span class="string">    &quot;permissions&quot;: [</span></span><br><span class="line"><span class="string">        &quot;proxy&quot;,</span></span><br><span class="line"><span class="string">        &quot;tabs&quot;,</span></span><br><span class="line"><span class="string">        &quot;unlimitedStorage&quot;,</span></span><br><span class="line"><span class="string">        &quot;storage&quot;,</span></span><br><span class="line"><span class="string">        &quot;&lt;all_urls&gt;&quot;,</span></span><br><span class="line"><span class="string">        &quot;webRequest&quot;,</span></span><br><span class="line"><span class="string">        &quot;webRequestBlocking&quot;</span></span><br><span class="line"><span class="string">    ],</span></span><br><span class="line"><span class="string">    &quot;background&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;scripts&quot;: [&quot;background.js&quot;]</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    &quot;minimum_chrome_version&quot;:&quot;22.0.0&quot;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">background_js = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">var config = &#123;</span></span><br><span class="line"><span class="string">        mode: &quot;fixed_servers&quot;,</span></span><br><span class="line"><span class="string">        rules: &#123;</span></span><br><span class="line"><span class="string">        singleProxy: &#123;</span></span><br><span class="line"><span class="string">            scheme: &quot;http&quot;,</span></span><br><span class="line"><span class="string">            host: &quot;%s&quot;,</span></span><br><span class="line"><span class="string">            port: parseInt(%s)</span></span><br><span class="line"><span class="string">        &#125;,</span></span><br><span class="line"><span class="string">        bypassList: [&quot;localhost&quot;]</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.proxy.settings.set(&#123;value: config, scope: &quot;regular&quot;&#125;, function() &#123;&#125;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">function callbackFn(details) &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        authCredentials: &#123;</span></span><br><span class="line"><span class="string">            username: &quot;%s&quot;,</span></span><br><span class="line"><span class="string">            password: &quot;%s&quot;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">chrome.webRequest.onAuthRequired.addListener(</span></span><br><span class="line"><span class="string">            callbackFn,</span></span><br><span class="line"><span class="string">            &#123;urls: [&quot;&lt;all_urls&gt;&quot;]&#125;,</span></span><br><span class="line"><span class="string">            [&#x27;blocking&#x27;]</span></span><br><span class="line"><span class="string">);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span> % (PROXY_HOST, PROXY_PORT, PROXY_USER, PROXY_PASS)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_chromedriver</span>(<span class="params">use_proxy=<span class="literal">False</span>, user_agent=<span class="literal">None</span>, use_docker=<span class="literal">True</span></span>):</span><br><span class="line">    path = os.path.dirname(os.path.abspath(__file__))</span><br><span class="line">    chrome_options = webdriver.ChromeOptions()</span><br><span class="line">    <span class="keyword">if</span> use_proxy:</span><br><span class="line">        pluginfile = <span class="string">&#x27;proxy_auth_plugin.zip&#x27;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> zipfile.ZipFile(pluginfile, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> zp:</span><br><span class="line">            zp.writestr(<span class="string">&quot;manifest.json&quot;</span>, manifest_json)</span><br><span class="line">            zp.writestr(<span class="string">&quot;background.js&quot;</span>, background_js)</span><br><span class="line">        chrome_options.add_extension(pluginfile)</span><br><span class="line">    <span class="keyword">if</span> user_agent:</span><br><span class="line">        chrome_options.add_argument(<span class="string">&#x27;--user-agent=%s&#x27;</span> % user_agent)</span><br><span class="line">    <span class="keyword">if</span> use_docker:</span><br><span class="line">        driver = webdriver.Remote(</span><br><span class="line">            command_executor=<span class="string">&quot;http://&#123;&#125;/wd/hub&quot;</span>.<span class="built_in">format</span>(REMOTE_SELENIUM),</span><br><span class="line">            <span class="comment"># command_executor=&quot;http://192.168.95.56:4444/wd/hub&quot;,</span></span><br><span class="line">            options=chrome_options</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        driver = webdriver.Chrome(</span><br><span class="line">            os.path.join(path, <span class="string">&#x27;/usr/local/bin/chromedriver&#x27;</span>),</span><br><span class="line">            chrome_options=chrome_options)</span><br><span class="line">    <span class="keyword">return</span> driver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># 使用代理 使用docker</span></span><br><span class="line">    driver = get_chromedriver(use_proxy=<span class="literal">True</span>, use_docker=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(driver)</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># driver = get_chromedriver(use_proxy=True, use_docker=True)</span></span><br><span class="line">        <span class="comment"># print(driver)</span></span><br><span class="line">        driver.get(<span class="string">&#x27;https://www.cip.cc&#x27;</span>)</span><br><span class="line">        ip_text = Selector(text=driver.page_source).xpath(</span><br><span class="line">            <span class="string">&#x27;//pre/text()&#x27;</span>).extract_first().strip()</span><br><span class="line">        <span class="built_in">print</span>(ip_text)</span><br><span class="line">        driver.close()</span><br><span class="line">        time.sleep(<span class="number">3</span>)</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n &gt; <span class="number">10</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    driver.quit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>效果图<br><img src="https://user-images.githubusercontent.com/16731803/67831841-84891600-fad7-11e9-9915-184e0b8df5b0.png"></p><p>二、selenium 使用芝麻代理等常规HOST:PORT代理</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line">PROXY = <span class="string">&quot;88.157.149.250:8080&quot;</span> <span class="comment"># IP:PORT or HOST:PORT</span></span><br><span class="line"></span><br><span class="line">chrome_options = webdriver.ChromeOptions()</span><br><span class="line">chrome_options.add_argument(<span class="string">&#x27;--proxy-server=%s&#x27;</span> % PROXY)</span><br><span class="line"></span><br><span class="line">chrome = webdriver.Chrome(chrome_options=chrome_options)</span><br><span class="line">chrome.get(<span class="string">&quot;http://www.cip.cc&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(chrome.page_source)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;p&gt;在docker中启动selenium gird使用扩展，并使用隧道代理，比如阿布云、多贝云、蘑菇代理。how to set proxy with authentication in selenium chromedriver python&lt;/p&gt;
&lt;p&gt;proxy</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>项目管理碎碎念：自动生成周报</title>
    <link href="https://clarklu.com/p/603a0fc5.html"/>
    <id>https://clarklu.com/p/603a0fc5.html</id>
    <published>2019-08-21T09:17:12.000Z</published>
    <updated>2025-11-20T09:43:36.467Z</updated>
    
    <content type="html"><![CDATA[<h1 id="项目管理碎碎念：自动生成周报"><a href="#项目管理碎碎念：自动生成周报" class="headerlink" title="项目管理碎碎念：自动生成周报"></a>项目管理碎碎念：自动生成周报</h1><h2 id="需求"><a href="#需求" class="headerlink" title="需求"></a>需求</h2><p>管理2-3个人的团队，需求如下：</p><ul><li>需要明确团队的任务</li><li>将团队的任务wbs，分解成每个人的任务</li><li>每周对上级进行周报汇报</li></ul><p>想得到的目标：</p><ul><li>明确的看板任务，提升团队效率</li><li>写总结报告的时候，不用纠结回忆，节省时间和心力，也不会遗漏</li></ul><h2 id="主角"><a href="#主角" class="headerlink" title="主角"></a>主角</h2><h3 id="Trello-Planyway"><a href="#Trello-Planyway" class="headerlink" title="Trello + Planyway"></a>Trello + Planyway</h3><ul><li><p>Trello的任务看板适合Get things done，随时添加零碎项目，提升效率。</p></li><li><p>Planyway的甘特图适合对整个工作阶段有个全局的认识<br><img src="http://cdn.luzihang.net/15663787045089.jpg"></p></li></ul><h3 id="Planyway"><a href="#Planyway" class="headerlink" title="Planyway"></a>Planyway</h3><ul><li>官网：<a href="https://planyway.com/">https://planyway.com/</a></li><li>Chrome extension 下载地址：<a href="https://chrome.google.com/webstore/detail/planyway-team-planner-for/kkgaechmpjgbojahkofamdjkaklgbdkc">https://chrome.google.com/webstore/detail/planyway-team-planner-for/kkgaechmpjgbojahkofamdjkaklgbdkc</a></li></ul><h2 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h2><p>Planyway生成一周的甘特图看板，进行周报汇总或者参考，当然也可以直接打印<br><img src="http://cdn.luzihang.net/15663779578975.jpg"></p><p>Trello钉钉提醒：<br><img src="http://cdn.luzihang.net/15663776272492.jpg"></p><h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul><li>工具免费：个人使用者的最大需求，秒杀</li><li>轻量、好学：比公司自建的jira、禅道 轻量，比omniplan好学</li><li>提醒及时：Trello生态强大，结合钉钉、slack等工具，提醒及时</li></ul><h2 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h2><p>安利大家可以用用，把工作搞得整整齐齐</p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;项目管理碎碎念：自动生成周报&quot;&gt;&lt;a href=&quot;#项目管理碎碎念：自动生成周报&quot; class=&quot;headerlink&quot; title=&quot;项目管理碎碎念：自动生成周报&quot;&gt;&lt;/a&gt;项目管理碎碎念：自动生成周报&lt;/h1&gt;&lt;h2 id=&quot;需求&quot;&gt;&lt;a</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
    <category term="项目管理" scheme="https://clarklu.com/tags/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>把布隆过滤器用起来</title>
    <link href="https://clarklu.com/p/12b51cde.html"/>
    <id>https://clarklu.com/p/12b51cde.html</id>
    <published>2019-07-10T11:43:43.000Z</published>
    <updated>2025-11-20T09:43:36.466Z</updated>
    
    <content type="html"><![CDATA[<h1 id="把布隆过滤器用起来"><a href="#把布隆过滤器用起来" class="headerlink" title="把布隆过滤器用起来"></a>把布隆过滤器用起来</h1><p>本文偏应用和代码实践，理论请参考本文末尾参考文章</p><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>一句话简介：<br>过滤器，判断这个元素在与不在，不在则100%不在；在则去查询，确认在不在。</p><p>详细简介：<br>BloomFilter，中文名称叫做布隆过滤器，是1970年由 Bloom 提出的，它可以被用来检测一个元素是否在一个集合中，它的空间利用效率很高，使用它可以大大节省存储空间。BloomFilter 使用位数组表示一个待检测集合，并可以快速地通过概率算法判断一个元素是否存在于这个集合中，所以利用这个算法我们可以实现去重效果。</p><p>它的优点是空间效率和查询时间都远远超过一般算法，缺点是有一定的误识别率和删除困难。</p><h2 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h2><p>1、大量爬虫数据去重</p><p>2、保护数据安全：<br>广告精确投放 ：广告主通过设备id，计算hash算法，在数据包（数据提供方）中去查找，如果在存在，则证明该设备id属于目标人群，进行投放广告，同时保证设备id不泄露。数据提供方和广告主都没有暴露自己拥有的设备id。间接用户画像且不违数据安全法。详见：<a href="https://zhuanlan.zhihu.com/p/37847480">https://zhuanlan.zhihu.com/p/37847480</a></p><p>3、比特币网络转账确认<br><img src="http://cdn.luzihang.net/15627501885022.jpg" alt="-w798"></p><p>SPV节点:SPV是“Simplified Payment Verification”（简单支付验证）的缩写。中本聪论文简要地提及了这一概念，指出：不运行完全节点也可验证支付，用户只需要保存所有的block header就可以了。用户虽然不能自己验证交易，但如果能够从区块链的某处找到相符的交易，他就可以知道网络已经认可了这笔交易，而且得到了网络的多少个确认。</p><p><img src="http://cdn.luzihang.net/15627510711127.jpg" alt="-w507"><br>先去访问布隆过滤器，去判断交易记录是否在某个block(区块)里存在。从海量数据(十亿个区块，每个区块1-2M的交易记录，)，快速得到结果。<br>详见:<a href="https://www.youtube.com/watch?v=uC6Q5m0SSQ0">https://www.youtube.com/watch?v=uC6Q5m0SSQ0</a></p><p>4、分布式系统（Map-Reduce）<br>把大任务切分成块，分配和验证一个子任务是否在一个子系统上。</p><h2 id="必要性"><a href="#必要性" class="headerlink" title="必要性"></a>必要性</h2><p>省空间，提升效率</p><p>我们首先来回顾一下 ScrapyRedis 的去重机制，它将 Request 的指纹存储到了 Redis 集合中，每个指纹的长度为 40，例如 27adcc2e8979cdee0c9cecbbe8bf8ff51edefb61 就是一个指纹，它的每一位都是 16 进制数。</p><p>让我们来计算一下用这种方式耗费的存储空间，每个 16 进制数占用 4b，1 个指纹用 40 个 16 进制数表示，占用空间为 20B，所以 1 万个指纹即占用空间 200KB，1 亿个指纹即占用 2G，所以当我们的爬取数量达到上亿级别时，Redis 的占用的内存就会变得很高，而且这仅仅是指纹的存储，另外 Redis 还存储了爬取队列，内存占用会进一步提高，更别说有多个 Scrapy 项目同时爬取的情况了。所以当爬取达到亿级别规模时 ScrapyRedis 提供的集合去重已经不能满足我们的要求，所以在这里我们需要使用一个更加节省内存的去重算法，它叫做 BloomFilter。</p><h2 id="内存版-Python实现的内存版布隆过滤器pybloom"><a href="#内存版-Python实现的内存版布隆过滤器pybloom" class="headerlink" title="(内存版)Python实现的内存版布隆过滤器pybloom"></a>(内存版)Python实现的内存版布隆过滤器pybloom</h2><p><a href="https://github.com/jaybaird/python-bloomfilter">https://github.com/jaybaird/python-bloomfilter</a><br>安装:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pybloom</span><br></pre></td></tr></table></figure><p>该模块包含两个类实现布隆过滤器功能。<br><code>BloomFilter</code> 是定容。<br><code>ScalableBloomFilter</code> 可以自动扩容</p><p>使用:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pybloom <span class="keyword">import</span> BloomFilter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = BloomFilter(capacity=<span class="number">1000</span>, error_rate=<span class="number">0.001</span>) <span class="comment"># capacity是容量, error_rate 是能容忍的误报率</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.add(<span class="string">&#x27;Traim304&#x27;</span>) <span class="comment"># 当不存在该元素,返回False</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.add(<span class="string">&#x27;Traim304&#x27;</span>) <span class="comment"># 若存在,返回 True</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Traim304&#x27;</span> <span class="keyword">in</span> f <span class="comment"># 值得注意的是若返回 True。该元素可能存在, 也可能不存在。过滤器能容许存在一定的错误</span></span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;Jacob&#x27;</span> <span class="keyword">in</span> f <span class="comment"># 但是 False。则必定不存在</span></span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(f) <span class="comment"># 当前存在的元素</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = BloomFilter(capacity=<span class="number">1000</span>, error_rate=<span class="number">0.001</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> pybloom <span class="keyword">import</span> ScalableBloomFilter</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>sbf = ScalableBloomFilter(mode=ScalableBloomFilter.SMALL_SET_GROWTH)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="comment"># sbf.add() 与 BloomFilter 同</span></span><br></pre></td></tr></table></figure><p>超过误报率时抛出异常</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>f = BloomFilter(capacity=<span class="number">1000</span>, error_rate=<span class="number">0.0000001</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line"><span class="meta">... </span>    _ = f.add(a)</span><br><span class="line">...</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(a)</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">TypeError: <span class="built_in">object</span> of <span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span> has no <span class="built_in">len</span>()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">len</span>(f)</span><br><span class="line"><span class="number">1000</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.add(<span class="number">1000</span>)</span><br><span class="line"><span class="literal">False</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>f.add(<span class="number">1001</span>) <span class="comment"># 当误报率超过 error_rate 会报错</span></span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">  File <span class="string">&quot;/usr/local/lib/python2.7/site-packages/pybloom/pybloom.py&quot;</span>, line <span class="number">182</span>, <span class="keyword">in</span> add</span><br><span class="line">    <span class="keyword">raise</span> IndexError(<span class="string">&quot;BloomFilter is at capacity&quot;</span>)</span><br><span class="line">IndexError: BloomFilter <span class="keyword">is</span> at capacity</span><br></pre></td></tr></table></figure><h2 id="持久化-手动实现的redis版布隆过滤器"><a href="#持久化-手动实现的redis版布隆过滤器" class="headerlink" title="(持久化)手动实现的redis版布隆过滤器"></a>(持久化)手动实现的redis版布隆过滤器</h2><p>大数据量，多用Redis持久化版本的布隆过滤器</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 布隆过滤器 redis版本实现</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"><span class="keyword">import</span> six</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 多个hash函数的实现和求值</span></span><br><span class="line"><span class="comment"># 2. hash表实现和实现对应的映射和判断</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MultipleHash</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;根据提供的原始数据，和预定义的多个salt，生成多个hash函数值&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, salts, hash_func_name=<span class="string">&quot;md5&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.hash_func = <span class="built_in">getattr</span>(hashlib, hash_func_name)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(salts) &lt; <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">&quot;请至少提供3个salt&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.salts = salts</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_hash_values</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;根据提供的原始数据, 返回多个hash函数值&#x27;&#x27;&#x27;</span></span><br><span class="line">        hash_values = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="variable language_">self</span>.salts:</span><br><span class="line">            hash_obj = <span class="variable language_">self</span>.hash_func()</span><br><span class="line">            hash_obj.update(<span class="variable language_">self</span>._safe_data(data))</span><br><span class="line">            hash_obj.update(<span class="variable language_">self</span>._safe_data(i))</span><br><span class="line">            ret = hash_obj.hexdigest()</span><br><span class="line">            hash_values.append(<span class="built_in">int</span>(ret, <span class="number">16</span>))</span><br><span class="line">        <span class="keyword">return</span> hash_values</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_safe_data</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        python2   str  === python3   bytes</span></span><br><span class="line"><span class="string">        python2   uniocde === python3  str</span></span><br><span class="line"><span class="string">        :param data: 给定的原始数据</span></span><br><span class="line"><span class="string">        :return: 二进制类型的字符串数据</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> six.PY3:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">bytes</span>):</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">                <span class="keyword">return</span> data.encode()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;请提供一个字符串&quot;</span>)   <span class="comment"># 建议使用英文来描述</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, <span class="built_in">str</span>):</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">elif</span> <span class="built_in">isinstance</span>(data, unicode):</span><br><span class="line">                <span class="keyword">return</span> data.encode()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> Exception(<span class="string">&quot;请提供一个字符串&quot;</span>)   <span class="comment"># 建议使用英文来描述</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BloomFilter</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, salts, redis_host=<span class="string">&quot;localhost&quot;</span>, redis_port=<span class="number">6379</span>, redis_db=<span class="number">0</span>, redis_key=<span class="string">&quot;bloomfilter&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.redis_host = redis_host</span><br><span class="line">        <span class="variable language_">self</span>.redis_port = redis_port</span><br><span class="line">        <span class="variable language_">self</span>.redis_db = redis_db</span><br><span class="line">        <span class="variable language_">self</span>.redis_key = redis_key</span><br><span class="line">        <span class="variable language_">self</span>.client = <span class="variable language_">self</span>._get_redis_client()</span><br><span class="line">        <span class="variable language_">self</span>.multiple_hash = MultipleHash(salts)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_redis_client</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;返回一个redis连接对象&#x27;&#x27;&#x27;</span></span><br><span class="line">        pool = redis.ConnectionPool(host=<span class="variable language_">self</span>.redis_host, port=<span class="variable language_">self</span>.redis_port, db=<span class="variable language_">self</span>.redis_db)</span><br><span class="line">        client = redis.StrictRedis(connection_pool=pool)</span><br><span class="line">        <span class="keyword">return</span> client</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;&#x27;&#x27;&#x27;</span></span><br><span class="line">        hash_values = <span class="variable language_">self</span>.multiple_hash.get_hash_values(data)</span><br><span class="line">        <span class="keyword">for</span> hash_value <span class="keyword">in</span> hash_values:</span><br><span class="line">            offset = <span class="variable language_">self</span>._get_offset(hash_value)</span><br><span class="line">            <span class="variable language_">self</span>.client.setbit(<span class="variable language_">self</span>.redis_key, offset, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">is_exists</span>(<span class="params">self, data</span>):</span><br><span class="line">        hash_values = <span class="variable language_">self</span>.multiple_hash.get_hash_values(data)</span><br><span class="line">        <span class="keyword">for</span> hash_value <span class="keyword">in</span> hash_values:</span><br><span class="line">            offset = <span class="variable language_">self</span>._get_offset(hash_value)</span><br><span class="line">            v = <span class="variable language_">self</span>.client.getbit(<span class="variable language_">self</span>.redis_key, offset)</span><br><span class="line">            <span class="keyword">if</span> v == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_offset</span>(<span class="params">self, hash_value</span>):</span><br><span class="line">        <span class="comment"># 512M长度哈希表 </span></span><br><span class="line">        <span class="comment"># 2**8 = 256</span></span><br><span class="line">        <span class="comment"># 2**20 = 1024 * 1024</span></span><br><span class="line">        <span class="comment"># (2**8 * 2**20 * 2*3) 代表hash表的长度  如果同一项目中不能更改</span></span><br><span class="line">        <span class="keyword">return</span> hash_value % (<span class="number">2</span>**<span class="number">8</span> * <span class="number">2</span>**<span class="number">20</span> * <span class="number">2</span>*<span class="number">3</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    data = [<span class="string">&quot;asdfasdf&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="string">&quot;123&quot;</span>, <span class="string">&quot;456&quot;</span>,<span class="string">&quot;asf&quot;</span>, <span class="string">&quot;asf&quot;</span>]</span><br><span class="line"></span><br><span class="line">    bm = BloomFilter(salts=[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>,<span class="string">&quot;3&quot;</span>, <span class="string">&quot;4&quot;</span>],redis_host=<span class="string">&quot;172.17.0.2&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> bm.is_exists(d):</span><br><span class="line">            bm.save(d)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;映射数据成功： &quot;</span>, d)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;发现重复数据：&quot;</span>, d)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="应用在scrapy-redis中"><a href="#应用在scrapy-redis中" class="headerlink" title="应用在scrapy-redis中"></a>应用在scrapy-redis中</h2><p>代码已经打包成了一个 Python 包并发布到了 PyPi，链接为：<a href="https://pypi.python.org/pypi/scrapy-redis-bloomfilter%EF%BC%8C%E5%9B%A0%E6%AD%A4%E6%88%91%E4%BB%AC%E4%BB%A5%E5%90%8E%E5%A6%82%E6%9E%9C%E6%83%B3%E4%BD%BF%E7%94%A8">https://pypi.python.org/pypi/scrapy-redis-bloomfilter，因此我们以后如果想使用</a> ScrapyRedisBloomFilter 直接使用就好了，不需要再自己实现一遍。</p><p>我们可以直接使用Pip来安装，命令如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install scrapy-redis-bloomfilter</span><br></pre></td></tr></table></figure><p>使用的方法和 ScrapyRedis 基本相似，在这里说明几个关键配置：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 去重类，要使用BloomFilter请替换DUPEFILTER_CLASS</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">&quot;scrapy_redis_bloomfilter.dupefilter.RFPDupeFilter&quot;</span></span><br><span class="line"><span class="comment"># 哈希函数的个数，默认为6，可以自行修改</span></span><br><span class="line">BLOOMFILTER_HASH_NUMBER = <span class="number">6</span></span><br><span class="line"><span class="comment"># BloomFilter的bit参数，默认30，占用128MB空间，去重量级1亿</span></span><br><span class="line">BLOOMFILTER_BIT = <span class="number">30</span></span><br></pre></td></tr></table></figure><p>DUPEFILTER_CLASS 是去重类，如果要使用 BloomFilter需要将 DUPEFILTER_CLASS 修改为该包的去重类。</p><p>BLOOMFILTER_HASH_NUMBER 是 BloomFilter 使用的哈希函数的个数，默认为 6，可以根据去重量级自行修改。</p><p>BLOOMFILTER_BIT 即前文所介绍的 BloomFilter 类的 bit 参数，它决定了位数组的位数，如果 BLOOMFILTER_BIT 为 30，那么位数组位数为 2 的 30次方，将占用 Redis 128MB 的存储空间，去重量级在 1 亿左右，即对应爬取量级 1 亿左右。如果爬取量级在 10亿、20 亿甚至 100 亿，请务必将此参数对应调高。</p><p>测试</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Spider 文件:</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Request, Spider</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestSpider</span>(<span class="title class_ inherited__">Spider</span>):</span><br><span class="line">    name = <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    base_url = <span class="string">&#x27;https://www.baidu.com/s?wd=&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            url = <span class="variable language_">self</span>.base_url + <span class="built_in">str</span>(i)</span><br><span class="line">            <span class="keyword">yield</span> Request(url, callback=<span class="variable language_">self</span>.parse)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Here contains 10 duplicated Requests    </span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>): </span><br><span class="line">            url = <span class="variable language_">self</span>.base_url + <span class="built_in">str</span>(i)</span><br><span class="line">            <span class="keyword">yield</span> Request(url, callback=<span class="variable language_">self</span>.parse)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="variable language_">self</span>.logger.debug(<span class="string">&#x27;Response of &#x27;</span> + response.url)</span><br></pre></td></tr></table></figure><p>在 start_requests() 方法中首先循环 10 次，构造参数为 0-9 的 URL，然后重新循环了 100 次，构造了参数为 0-99 的 URL，那么这里就会包含 10 个重复的 Request，我们运行项目测试一下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scrapy crawl test</span><br></pre></td></tr></table></figure><p>可以看到最后的输出结果如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&#x27;bloomfilter/filtered&#x27;</span>: <span class="number">10</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/request_bytes&#x27;</span>: <span class="number">34021</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/request_count&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/request_method_count/GET&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/response_bytes&#x27;</span>: <span class="number">72943</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/response_count&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;downloader/response_status_count/200&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;finish_reason&#x27;</span>: <span class="string">&#x27;finished&#x27;</span>,</span><br><span class="line"> <span class="string">&#x27;finish_time&#x27;</span>: datetime.datetime(<span class="number">2017</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">34</span>, <span class="number">30</span>, <span class="number">419597</span>),</span><br><span class="line"> <span class="string">&#x27;log_count/DEBUG&#x27;</span>: <span class="number">202</span>,</span><br><span class="line"> <span class="string">&#x27;log_count/INFO&#x27;</span>: <span class="number">7</span>,</span><br><span class="line"> <span class="string">&#x27;memusage/max&#x27;</span>: <span class="number">54153216</span>,</span><br><span class="line"> <span class="string">&#x27;memusage/startup&#x27;</span>: <span class="number">54153216</span>,</span><br><span class="line"> <span class="string">&#x27;response_received_count&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;scheduler/dequeued/redis&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;scheduler/enqueued/redis&#x27;</span>: <span class="number">100</span>,</span><br><span class="line"> <span class="string">&#x27;start_time&#x27;</span>: datetime.datetime(<span class="number">2017</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">495018</span>)&#125;</span><br></pre></td></tr></table></figure><p>可以看到最后统计的第一行的结果：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;bloomfilter/filtered&#x27;</span>: <span class="number">10</span>,</span><br></pre></td></tr></table></figure><p>这就是 BloomFilter 过滤后的统计结果，可以看到它的过滤个数为 10 个，也就是它成功将重复的 10 个 Reqeust 识别出来了，测试通过。</p><h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>本文偏应用，难以描述的原理，最后说。<br>一个很长的二进制向量和一个映射函数。</p><p><img src="http://cdn.luzihang.net/15627480992370.jpg" alt="-w1209"></p><p><img src="http://cdn.luzihang.net/15627481147872.jpg" alt="-w1161"></p><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>1、<a href="https://zhuanlan.zhihu.com/p/37847480">https://zhuanlan.zhihu.com/p/37847480</a><br>2、<a href="https://www.youtube.com/watch?v=uC6Q5m0SSQ0">https://www.youtube.com/watch?v=uC6Q5m0SSQ0</a><br>3、《python3网络爬虫开发实战》崔庆才<br>4、<a href="https://www.jianshu.com/p/f57187e2b5b9">https://www.jianshu.com/p/f57187e2b5b9</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;把布隆过滤器用起来&quot;&gt;&lt;a href=&quot;#把布隆过滤器用起来&quot; class=&quot;headerlink&quot; title=&quot;把布隆过滤器用起来&quot;&gt;&lt;/a&gt;把布隆过滤器用起来&lt;/h1&gt;&lt;p&gt;本文偏应用和代码实践，理论请参考本文末尾参考文章&lt;/p&gt;
&lt;h2</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>02Python中一切皆对象——Python高级编程和异步IO并发编程</title>
    <link href="https://clarklu.com/p/c6651072.html"/>
    <id>https://clarklu.com/p/c6651072.html</id>
    <published>2019-06-10T15:55:38.000Z</published>
    <updated>2025-11-20T09:43:36.462Z</updated>
    
    <content type="html"><![CDATA[<h1 id="02Python中一切皆对象——Python高级编程和异步IO并发编程"><a href="#02Python中一切皆对象——Python高级编程和异步IO并发编程" class="headerlink" title="02Python中一切皆对象——Python高级编程和异步IO并发编程"></a>02Python中一切皆对象——Python高级编程和异步IO并发编程</h1><h2 id="2-1-Python中一切皆是对象"><a href="#2-1-Python中一切皆是对象" class="headerlink" title="2.1 Python中一切皆是对象"></a>2.1 Python中一切皆是对象</h2><h3 id="讲解动态语言和静态语言的区别"><a href="#讲解动态语言和静态语言的区别" class="headerlink" title="讲解动态语言和静态语言的区别"></a>讲解动态语言和静态语言的区别</h3><h4 id="Python的面向对象更彻底"><a href="#Python的面向对象更彻底" class="headerlink" title="Python的面向对象更彻底"></a>Python的面向对象更彻底</h4><h3 id="函数和类也是对象，属于Python的一等公民"><a href="#函数和类也是对象，属于Python的一等公民" class="headerlink" title="函数和类也是对象，属于Python的一等公民"></a>函数和类也是对象，属于Python的一等公民</h3><h4 id="1、赋值给一个变量"><a href="#1、赋值给一个变量" class="headerlink" title="1、赋值给一个变量"></a>1、赋值给一个变量</h4><h4 id="2、可以添加到集合对象中"><a href="#2、可以添加到集合对象中" class="headerlink" title="2、可以添加到集合对象中"></a>2、可以添加到集合对象中</h4><h4 id="3、可以作为参数传递给函数"><a href="#3、可以作为参数传递给函数" class="headerlink" title="3、可以作为参数传递给函数"></a>3、可以作为参数传递给函数</h4><h4 id="4、可以当做函数的返回值"><a href="#4、可以当做函数的返回值" class="headerlink" title="4、可以当做函数的返回值"></a>4、可以当做函数的返回值</h4><h2 id="2-2-type、object和class的关系"><a href="#2-2-type、object和class的关系" class="headerlink" title="2.2 type、object和class的关系"></a>2.2 type、object和class的关系</h2><h2 id="2-3-Python中的常见内置类型"><a href="#2-3-Python中的常见内置类型" class="headerlink" title="2.3 Python中的常见内置类型"></a>2.3 Python中的常见内置类型</h2><h2 id="2-4-本章小结"><a href="#2-4-本章小结" class="headerlink" title="2.4 本章小结"></a>2.4 本章小结</h2>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;02Python中一切皆对象——Python高级编程和异步IO并发编程&quot;&gt;&lt;a href=&quot;#02Python中一切皆对象——Python高级编程和异步IO并发编程&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="「笔记」" scheme="https://clarklu.com/categories/%E3%80%8C%E7%AC%94%E8%AE%B0%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>01课程介绍——Python高级编程和异步IO并发编程</title>
    <link href="https://clarklu.com/p/2ed8a5ab.html"/>
    <id>https://clarklu.com/p/2ed8a5ab.html</id>
    <published>2019-06-10T15:21:08.000Z</published>
    <updated>2025-11-20T09:43:36.461Z</updated>
    
    <content type="html"><![CDATA[<h1 id="01课程介绍——Python高级编程和异步IO并发编程"><a href="#01课程介绍——Python高级编程和异步IO并发编程" class="headerlink" title="01课程介绍——Python高级编程和异步IO并发编程"></a>01课程介绍——Python高级编程和异步IO并发编程</h1><h2 id="为什么需要进阶"><a href="#为什么需要进阶" class="headerlink" title="为什么需要进阶"></a>为什么需要进阶</h2><p>Python高级工程师会面试什么<br>我们只需要知道当前的Python知识就够了吗？<br>语言本身的进阶知识优先于框架，大公司更注重语言本身的功底</p><h2 id="如何进阶"><a href="#如何进阶" class="headerlink" title="如何进阶"></a>如何进阶</h2><p>和大神一起<br><strong>阅读优秀源码、懂原理</strong><br>面试、多做项目</p><h2 id="你是否遇到"><a href="#你是否遇到" class="headerlink" title="你是否遇到"></a>你是否遇到</h2><p>看不懂优秀库和框架的源码<br>不知道如何才能进一步优化自己的代码<br>asyncio、tornado 等异步框架背后的原理<br>Python代码灵活背后的设计原理<br>对生成器稀里糊涂<br>很多Python抛出的异常看不懂</p><h2 id="课程概述"><a href="#课程概述" class="headerlink" title="课程概述"></a>课程概述</h2><p>目标：系统全面学习Python高级知识和并发编程<br>方法：功能-&gt;原理-&gt;应用案例<br>技术：面向对象、魔法方法、元类、生成器、多线程-&gt;协程</p><h2 id="章节安排"><a href="#章节安排" class="headerlink" title="章节安排"></a>章节安排</h2><h3 id="01-课程介绍"><a href="#01-课程介绍" class="headerlink" title="01 课程介绍"></a>01 课程介绍</h3><h3 id="02-Python中一切皆对象"><a href="#02-Python中一切皆对象" class="headerlink" title="02 Python中一切皆对象"></a>02 Python中一切皆对象</h3><h3 id="03-魔法方法"><a href="#03-魔法方法" class="headerlink" title="03 魔法方法"></a>03 魔法方法</h3><h3 id="04-深入类和对象"><a href="#04-深入类和对象" class="headerlink" title="04 深入类和对象"></a>04 深入类和对象</h3><h3 id="05-自定义序列类"><a href="#05-自定义序列类" class="headerlink" title="05 自定义序列类"></a>05 自定义序列类</h3><h3 id="06-深入Python的set和dict"><a href="#06-深入Python的set和dict" class="headerlink" title="06 深入Python的set和dict"></a>06 深入Python的set和dict</h3><h3 id="07-对象引用、可变性和垃圾回收"><a href="#07-对象引用、可变性和垃圾回收" class="headerlink" title="07 对象引用、可变性和垃圾回收"></a>07 对象引用、可变性和垃圾回收</h3><h3 id="08-元类编程"><a href="#08-元类编程" class="headerlink" title="08 元类编程"></a>08 元类编程</h3><h3 id="09-迭代器和生成器"><a href="#09-迭代器和生成器" class="headerlink" title="09 迭代器和生成器"></a>09 迭代器和生成器</h3><h3 id="10-Python-socket编程"><a href="#10-Python-socket编程" class="headerlink" title="10 Python socket编程"></a>10 Python socket编程</h3><h3 id="11-多线程、多进程和线程池编程"><a href="#11-多线程、多进程和线程池编程" class="headerlink" title="11 多线程、多进程和线程池编程"></a>11 多线程、多进程和线程池编程</h3><h3 id="12、协程和异步IO"><a href="#12、协程和异步IO" class="headerlink" title="12、协程和异步IO"></a>12、协程和异步IO</h3><h3 id="13、asyncio并发编程"><a href="#13、asyncio并发编程" class="headerlink" title="13、asyncio并发编程"></a>13、asyncio并发编程</h3><h3 id="14、课程总结"><a href="#14、课程总结" class="headerlink" title="14、课程总结"></a>14、课程总结</h3><h2 id="课程安排"><a href="#课程安排" class="headerlink" title="课程安排"></a>课程安排</h2><h3 id="一切皆对象"><a href="#一切皆对象" class="headerlink" title="一切皆对象"></a>一切皆对象</h3><h3 id="魔法方法详解"><a href="#魔法方法详解" class="headerlink" title="魔法方法详解"></a>魔法方法详解</h3><h3 id="Python序列协议"><a href="#Python序列协议" class="headerlink" title="Python序列协议"></a>Python序列协议</h3><h3 id="深入dict和set"><a href="#深入dict和set" class="headerlink" title="深入dict和set"></a>深入dict和set</h3><h3 id="迭代器和生成器详解"><a href="#迭代器和生成器详解" class="headerlink" title="迭代器和生成器详解"></a>迭代器和生成器详解</h3><h3 id="socket编程详解"><a href="#socket编程详解" class="headerlink" title="socket编程详解"></a>socket编程详解</h3><h3 id="对象引用和可变性、垃圾回收"><a href="#对象引用和可变性、垃圾回收" class="headerlink" title="对象引用和可变性、垃圾回收"></a>对象引用和可变性、垃圾回收</h3><h3 id="元类编程"><a href="#元类编程" class="headerlink" title="元类编程"></a>元类编程</h3><h3 id="多线程（池）、多进程（池）"><a href="#多线程（池）、多进程（池）" class="headerlink" title="多线程（池）、多进程（池）"></a>多线程（池）、多进程（池）</h3><h3 id="异步io和协程"><a href="#异步io和协程" class="headerlink" title="异步io和协程"></a>异步io和协程</h3><h3 id="asyncio并发编程"><a href="#asyncio并发编程" class="headerlink" title="asyncio并发编程"></a>asyncio并发编程</h3><h2 id="课程安排-面向对象"><a href="#课程安排-面向对象" class="headerlink" title="课程安排-面向对象"></a>课程安排-面向对象</h2><h3 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h3><h3 id="抽象基类"><a href="#抽象基类" class="headerlink" title="抽象基类"></a>抽象基类</h3><h3 id="MRO属性查找算法和super函数"><a href="#MRO属性查找算法和super函数" class="headerlink" title="MRO属性查找算法和super函数"></a>MRO属性查找算法和super函数</h3><h3 id="静态方法、类方法、实例方法"><a href="#静态方法、类方法、实例方法" class="headerlink" title="静态方法、类方法、实例方法"></a>静态方法、类方法、实例方法</h3><h3 id="数据封装和私有属性"><a href="#数据封装和私有属性" class="headerlink" title="数据封装和私有属性"></a>数据封装和私有属性</h3><h3 id="对象的自省机制"><a href="#对象的自省机制" class="headerlink" title="对象的自省机制"></a>对象的自省机制</h3><h3 id="上下文管理器"><a href="#上下文管理器" class="headerlink" title="上下文管理器"></a>上下文管理器</h3><h3 id="contextlib实现上下文管理器"><a href="#contextlib实现上下文管理器" class="headerlink" title="contextlib实现上下文管理器"></a>contextlib实现上下文管理器</h3><h3 id="mixin继承模式的应用"><a href="#mixin继承模式的应用" class="headerlink" title="mixin继承模式的应用"></a>mixin继承模式的应用</h3><h2 id="课程安排-元类"><a href="#课程安排-元类" class="headerlink" title="课程安排-元类"></a>课程安排-元类</h2><h3 id="property动态属性"><a href="#property动态属性" class="headerlink" title="property动态属性"></a>property动态属性</h3><h3 id="getattr、-getattribute-的区别"><a href="#getattr、-getattribute-的区别" class="headerlink" title="getattr、__getattribute__的区别"></a><strong>getattr</strong>、__getattribute__的区别</h3><h3 id="属性描述符"><a href="#属性描述符" class="headerlink" title="属性描述符"></a>属性描述符</h3><h3 id="new-和-init"><a href="#new-和-init" class="headerlink" title="new__和__init"></a><strong>new__和__init</strong></h3><h3 id="元类实现orm"><a href="#元类实现orm" class="headerlink" title="元类实现orm"></a>元类实现orm</h3><h2 id="课程安排-多线程"><a href="#课程安排-多线程" class="headerlink" title="课程安排-多线程"></a>课程安排-多线程</h2><h3 id="GIL和多线程"><a href="#GIL和多线程" class="headerlink" title="GIL和多线程"></a>GIL和多线程</h3><h3 id="线程通信-共享变量、Queue"><a href="#线程通信-共享变量、Queue" class="headerlink" title="线程通信-共享变量、Queue"></a>线程通信-共享变量、Queue</h3><h3 id="线程同步-Lock、RLock、Condition、Semaphores"><a href="#线程同步-Lock、RLock、Condition、Semaphores" class="headerlink" title="线程同步-Lock、RLock、Condition、Semaphores"></a>线程同步-Lock、RLock、Condition、Semaphores</h3><h3 id="线程池和源码分析-ThreadPoolExecutor"><a href="#线程池和源码分析-ThreadPoolExecutor" class="headerlink" title="线程池和源码分析-ThreadPoolExecutor"></a>线程池和源码分析-ThreadPoolExecutor</h3><h3 id="多进程-multiprocessing"><a href="#多进程-multiprocessing" class="headerlink" title="多进程-multiprocessing"></a>多进程-multiprocessing</h3><h3 id="进程间通信"><a href="#进程间通信" class="headerlink" title="进程间通信"></a>进程间通信</h3><h2 id="课程安排-异步IO"><a href="#课程安排-异步IO" class="headerlink" title="课程安排-异步IO"></a>课程安排-异步IO</h2><h3 id="IO多路复用-select、poll、epoll"><a href="#IO多路复用-select、poll、epoll" class="headerlink" title="IO多路复用-select、poll、epoll"></a>IO多路复用-select、poll、epoll</h3><h3 id="select-回调-事件循环模式"><a href="#select-回调-事件循环模式" class="headerlink" title="select+回调+事件循环模式"></a>select+回调+事件循环模式</h3><h3 id="生成器进阶-send、close、throw和yield-from"><a href="#生成器进阶-send、close、throw和yield-from" class="headerlink" title="生成器进阶-send、close、throw和yield from"></a>生成器进阶-send、close、throw和yield from</h3><h3 id="async和await"><a href="#async和await" class="headerlink" title="async和await"></a>async和await</h3><h2 id="课程安排-asyncio"><a href="#课程安排-asyncio" class="headerlink" title="课程安排-asyncio"></a>课程安排-asyncio</h2><h3 id="Future和Task"><a href="#Future和Task" class="headerlink" title="Future和Task"></a>Future和Task</h3><h3 id="aiohttp实现高并发抓取url"><a href="#aiohttp实现高并发抓取url" class="headerlink" title="aiohttp实现高并发抓取url"></a>aiohttp实现高并发抓取url</h3><h3 id="asyncio-背后的selector"><a href="#asyncio-背后的selector" class="headerlink" title="asyncio 背后的selector"></a>asyncio 背后的selector</h3><h3 id="协程同步和通信"><a href="#协程同步和通信" class="headerlink" title="协程同步和通信"></a>协程同步和通信</h3><h3 id="ThreadPoolExecutor-asyncio"><a href="#ThreadPoolExecutor-asyncio" class="headerlink" title="ThreadPoolExecutor + asyncio"></a>ThreadPoolExecutor + asyncio</h3>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;01课程介绍——Python高级编程和异步IO并发编程&quot;&gt;&lt;a href=&quot;#01课程介绍——Python高级编程和异步IO并发编程&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="「笔记」" scheme="https://clarklu.com/categories/%E3%80%8C%E7%AC%94%E8%AE%B0%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>scrapy-spalsh使用UA和IP代理</title>
    <link href="https://clarklu.com/p/c8c843a9.html"/>
    <id>https://clarklu.com/p/c8c843a9.html</id>
    <published>2019-05-27T07:53:56.000Z</published>
    <updated>2025-11-20T09:43:36.462Z</updated>
    
    <content type="html"><![CDATA[<h1 id="scrapy-spalsh使用UA和IP代理"><a href="#scrapy-spalsh使用UA和IP代理" class="headerlink" title="scrapy-spalsh使用UA和IP代理"></a>scrapy-spalsh使用UA和IP代理</h1><h3 id="核心"><a href="#核心" class="headerlink" title="核心"></a>核心</h3><p>设置UA，优先在lua脚本中使用splash:set_user_agent(“{ua}”)</p><p>设置ip代理，使用SplashRequest的proxy</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install fake-useragent</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy <span class="keyword">import</span> Spider</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> scrapy_splash <span class="keyword">import</span> SplashRequest</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> risk_control_info.utils <span class="keyword">import</span> get_proxy_ip</span><br><span class="line"><span class="keyword">from</span> fake_useragent <span class="keyword">import</span> UserAgent</span><br><span class="line"></span><br><span class="line">ua = UserAgent()</span><br><span class="line">script = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function main(splash, args)</span></span><br><span class="line"><span class="string">  splash.images_enabled = false</span></span><br><span class="line"><span class="string">  splash:set_user_agent(&quot;&#123;ua&#125;&quot;)</span></span><br><span class="line"><span class="string">  assert(splash:go(args.url))</span></span><br><span class="line"><span class="string">  assert(splash:wait(args.wait))</span></span><br><span class="line"><span class="string">  return splash:html()</span></span><br><span class="line"><span class="string">end&quot;&quot;&quot;</span>.<span class="built_in">format</span>(ua=ua.chrome)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AppQimaiHotSearchSpider</span>(scrapy.Spider):</span><br><span class="line">    name = <span class="string">&#x27;app_qimai_hot_search&#x27;</span></span><br><span class="line">    allowed_domains = [<span class="string">&#x27;qimai.cn&#x27;</span>]</span><br><span class="line">    user_agent = ua.chrome</span><br><span class="line">    custom_settings = &#123;</span><br><span class="line">        <span class="string">&#x27;DOWNLOADER_MIDDLEWARES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;scrapy_splash.SplashCookiesMiddleware&#x27;</span>: <span class="number">723</span>,</span><br><span class="line">            <span class="string">&#x27;scrapy_splash.SplashMiddleware&#x27;</span>: <span class="number">725</span>,</span><br><span class="line">            <span class="string">&#x27;scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware&#x27;</span>: <span class="number">810</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&#x27;SPIDER_MIDDLEWARES&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;scrapy_splash.SplashDeduplicateArgsMiddleware&#x27;</span>: <span class="number">100</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">start_requests</span>(<span class="params">self</span>):</span><br><span class="line">        url = <span class="string">&quot;http://httpbin.org/get&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> SplashRequest(url=url,</span><br><span class="line">                            callback=<span class="variable language_">self</span>.parse,</span><br><span class="line">                            endpoint=<span class="string">&#x27;execute&#x27;</span>,</span><br><span class="line">                            args=&#123;</span><br><span class="line">                                <span class="string">&#x27;lua_source&#x27;</span>: script,</span><br><span class="line">                                <span class="string">&#x27;proxy&#x27;</span>: <span class="string">&quot;http://&quot;</span> + get_proxy_ip(url),</span><br><span class="line">                                <span class="string">&#x27;wait&#x27;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">parse</span>(<span class="params">self, response</span>):</span><br><span class="line">        <span class="built_in">print</span>(response.body.decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h3><p><img src="http://cdn.luzihang.net/15589436767363.jpg"></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;scrapy-spalsh使用UA和IP代理&quot;&gt;&lt;a href=&quot;#scrapy-spalsh使用UA和IP代理&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>00 机器学习概述、特征工程、机器学习算法</title>
    <link href="https://clarklu.com/p/14207b93.html"/>
    <id>https://clarklu.com/p/14207b93.html</id>
    <published>2019-05-07T06:23:03.000Z</published>
    <updated>2025-11-20T09:43:36.460Z</updated>
    
    <content type="html"><![CDATA[<h1 id="00-机器学习概述、特征工程、机器学习算法"><a href="#00-机器学习概述、特征工程、机器学习算法" class="headerlink" title="00 机器学习概述、特征工程、机器学习算法"></a>00 机器学习概述、特征工程、机器学习算法</h1><h2 id="引入："><a href="#引入：" class="headerlink" title="引入："></a>引入：</h2><h3 id="”人工智能之父“-艾伦图灵：图灵测试"><a href="#”人工智能之父“-艾伦图灵：图灵测试" class="headerlink" title="”人工智能之父“ 艾伦图灵：图灵测试"></a>”人工智能之父“ 艾伦图灵：图灵测试</h3><p><img src="http://cdn.luzihang.net/15580187658215.jpg"><br><img src="http://cdn.luzihang.net/15580187694820.jpg"></p><h3 id="马文·李·闵斯基（英语：Marvin-Lee-Minsky，1927年8月9日－2016年1月24日），科学家"><a href="#马文·李·闵斯基（英语：Marvin-Lee-Minsky，1927年8月9日－2016年1月24日），科学家" class="headerlink" title="马文·李·闵斯基（英语：Marvin Lee Minsky，1927年8月9日－2016年1月24日），科学家"></a>马文·李·闵斯基（英语：Marvin Lee Minsky，1927年8月9日－2016年1月24日），科学家</h3><p>专长于认知科学与人工智能领域，麻省理工学院人工智能实验室的创始人之一，著有几部人工智能和哲学方面的作品。1969年，因为在人工智能领域的贡献，获得图灵奖。<br><img src="http://cdn.luzihang.net/15580210073363.jpg"></p><h3 id="关系"><a href="#关系" class="headerlink" title="关系"></a>关系</h3><p><img src="http://cdn.luzihang.net/15580210214838.jpg"></p><h3 id="新闻一“小”一“同”"><a href="#新闻一“小”一“同”" class="headerlink" title="新闻一“小”一“同”"></a>新闻一“小”一“同”</h3><p>南方都市报的“小南”，广州日报的“阿同”机器人</p><p>技术方面的话，主要是计算机视觉，自然语言处理，数据挖掘。</p><p> 计算机视觉就包括图像识别，视频识别，具体应用有人脸识别，步态识别，无人驾驶汽车等等。</p><p> 自然语言处理包括机器翻译，语音识别，文本挖掘等等，像siri，谷歌翻译里面都有很多的自然语言处理技术。</p><p> 数据挖掘主要是各种推荐和预测，包括电子商务的商品推荐，计算广告，社交网络分析（微博好友推荐等），预测一些趋势，比如股市的走向，天气的变化等。</p><p><img src="http://cdn.luzihang.net/15580210338452.jpg"></p><p><img src="http://cdn.luzihang.net/15580210377199.jpg"></p><h3 id="无人驾驶"><a href="#无人驾驶" class="headerlink" title="无人驾驶"></a>无人驾驶</h3><p><img src="http://cdn.luzihang.net/15580210471247.jpg"><br>百度：阿波罗</p><h3 id="医疗"><a href="#医疗" class="headerlink" title="医疗"></a>医疗</h3><p><img src="http://cdn.luzihang.net/15580210590793.jpg"></p><p>医疗CT</p><h3 id="量化交易"><a href="#量化交易" class="headerlink" title="量化交易"></a>量化交易</h3><h3 id="图片艺术化-GAN神经网络："><a href="#图片艺术化-GAN神经网络：" class="headerlink" title="图片艺术化 GAN神经网络："></a>图片艺术化 GAN神经网络：</h3><p><img src="http://cdn.luzihang.net/15580210701143.jpg"><br>视觉相关处理</p><h3 id="Ai智能手机"><a href="#Ai智能手机" class="headerlink" title="Ai智能手机"></a>Ai智能手机</h3><p><img src="http://cdn.luzihang.net/15580210779268.jpg"></p><h3 id="智能推荐"><a href="#智能推荐" class="headerlink" title="智能推荐"></a>智能推荐</h3><p><img src="http://cdn.luzihang.net/15580210945197.jpg"></p><h3 id="开发框架"><a href="#开发框架" class="headerlink" title="开发框架"></a>开发框架</h3><p>pytorch<br><img src="http://cdn.luzihang.net/15580211032641.jpg"></p><p>TensorFlow：</p><p>scikit-learn：<br><img src="http://cdn.luzihang.net/15580211130390.jpg"></p><h3 id="推荐书籍和知识背景"><a href="#推荐书籍和知识背景" class="headerlink" title="推荐书籍和知识背景"></a>推荐书籍和知识背景</h3><p><img src="http://cdn.luzihang.net/15580211289766.jpg"><br><img src="http://cdn.luzihang.net/15580211324048.jpg"></p><p><img src="http://cdn.luzihang.net/15580211374817.jpg"></p><p><img src="http://cdn.luzihang.net/15580211541727.jpg"></p><p><img src="http://cdn.luzihang.net/15580211591779.jpg"></p><p><img src="http://cdn.luzihang.net/15580211636699.jpg"></p><h2 id="机器学习概述"><a href="#机器学习概述" class="headerlink" title="机器学习概述"></a>机器学习概述</h2><h3 id="什么是-机器学习"><a href="#什么是-机器学习" class="headerlink" title="什么是 机器学习"></a>什么是 机器学习</h3><p>机器学习是从<strong>数据</strong>中自动分析获得<strong>规律（模型）</strong>，并利用规律对<strong>未知数据进行预测</strong></p><p><strong>案例：分辨啤酒还是红酒</strong><br><img src="http://cdn.luzihang.net/15580211946131.jpg"></p><p>搜集数据：<br><img src="http://cdn.luzihang.net/15580211997894.jpg"></p><p>准备数据<br><img src="http://cdn.luzihang.net/15580212050906.jpg"></p><h3 id="为什么-需要机器学习"><a href="#为什么-需要机器学习" class="headerlink" title="为什么 需要机器学习"></a>为什么 需要机器学习</h3><h3 id="怎么用-机器学习（应用场景）"><a href="#怎么用-机器学习（应用场景）" class="headerlink" title="怎么用 机器学习（应用场景）"></a>怎么用 机器学习（应用场景）</h3><h2 id="数据来源与类型"><a href="#数据来源与类型" class="headerlink" title="数据来源与类型"></a>数据来源与类型</h2><h2 id="数据的特征工程"><a href="#数据的特征工程" class="headerlink" title="数据的特征工程"></a>数据的特征工程</h2><h2 id="机器学习基础"><a href="#机器学习基础" class="headerlink" title="机器学习基础"></a>机器学习基础</h2>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;00-机器学习概述、特征工程、机器学习算法&quot;&gt;&lt;a href=&quot;#00-机器学习概述、特征工程、机器学习算法&quot; class=&quot;headerlink&quot; title=&quot;00 机器学习概述、特征工程、机器学习算法&quot;&gt;&lt;/a&gt;00</summary>
        
      
    
    
    
    <category term="「笔记」" scheme="https://clarklu.com/categories/%E3%80%8C%E7%AC%94%E8%AE%B0%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>在Centos7使用supervisor</title>
    <link href="https://clarklu.com/p/8961b837.html"/>
    <id>https://clarklu.com/p/8961b837.html</id>
    <published>2018-07-23T07:48:06.000Z</published>
    <updated>2025-11-20T09:43:36.465Z</updated>
    
    <content type="html"><![CDATA[<h1 id="在Centos7使用supervisor"><a href="#在Centos7使用supervisor" class="headerlink" title="在Centos7使用supervisor"></a>在Centos7使用supervisor</h1><p>置顶：<br>推荐使用pip install supervisor安装最新版supervisor，yum install supervisor最高版本3.1.4，有很多bug</p><h2 id="名称解释"><a href="#名称解释" class="headerlink" title="名称解释"></a>名称解释</h2><p>supervisor：要安装的软件的名称。<br>supervisord：装好supervisor软件后，supervisord用于启动supervisor服务。<br>supervisorctl：用于管理supervisor配置文件中program。</p><h2 id="Centos7-Python3-7安装最新版supervisor"><a href="#Centos7-Python3-7安装最新版supervisor" class="headerlink" title="Centos7 Python3.7安装最新版supervisor"></a>Centos7 Python3.7安装最新版supervisor</h2><p>Centos7 通过编译安装的Python3.7 pip37 安装supervisor最新版。pyhton3支持日志中文，python3配合最新版supervisor，bug最少，体验最佳。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ pip37 install supervisor                                                                                                                                       </span><br><span class="line">Looking in indexes: https://mirrors.aliyun.com/pypi/simple</span><br><span class="line">Collecting supervisor</span><br><span class="line">  Downloading https://mirrors.aliyun.com/pypi/packages/ca/1f/07713b0e1e34c312450878801d496bce8b9eff5ea9e70d41ff4e299b2df5/supervisor-4.1.0-py2.py3-none-any.whl (318</span><br><span class="line">kB)</span><br><span class="line">     |████████████████████████████████| 327kB 46.5MB/s                                                                                                              </span><br><span class="line">Installing collected packages: supervisor</span><br><span class="line">Successfully installed supervisor-4.1.0</span><br></pre></td></tr></table></figure><p>卸载的时候，发现了Python3的supervisor路径</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ pip37 uninstall supervisor                                                                                                                                     </span><br><span class="line">Uninstalling supervisor-4.1.0:</span><br><span class="line">  Would remove:</span><br><span class="line">    /usr/local/python3/bin/echo_supervisord_conf</span><br><span class="line">    /usr/local/python3/bin/pidproxy</span><br><span class="line">    /usr/local/python3/bin/supervisorctl</span><br><span class="line">    /usr/local/python3/bin/supervisord</span><br><span class="line">    /usr/local/python3/lib/python3.7/site-packages/supervisor-4.1.0.dist-info/*</span><br><span class="line">    /usr/local/python3/lib/python3.7/site-packages/supervisor/*</span><br><span class="line">Proceed (y/n)? y</span><br><span class="line">  Successfully uninstalled supervisor-4.1.0</span><br></pre></td></tr></table></figure><p>supervisor配置</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ /usr/local/python3/bin/echo_supervisord_conf &gt; /etc/supervisor/supervisord.conf  </span><br><span class="line">➜  ~ vim /etc/supervisor/supervisord.conf </span><br><span class="line"></span><br><span class="line">web界面配置</span><br><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default                                                                                                  </span><br><span class="line">port=*:9001        ; ip_address:port specifier, *:port for all iface                                                                                                </span><br><span class="line">username=clark              ; default is no username (open server)                                                                                             </span><br><span class="line">password=123456              ; default is no password (open server) </span><br><span class="line"></span><br><span class="line">指定配置文件目录</span><br><span class="line">[include]                                                                                                                                        </span><br><span class="line">files = /etc/supervisor/config.d/*.ini  </span><br></pre></td></tr></table></figure><p>启动服务</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ /usr/local/python3/bin/supervisord -c /etc/supervisor/supervisord.conf </span><br><span class="line">➜  ~ ps -ef|grep supervisord # 查看是否存在supervisord进程                                                                                                          </span><br><span class="line">root     16641     1  0 19:46 ?        00:00:00 /usr/local/python3/bin/python3.7 /usr/local/python3/bin/supervisord -c /etc/supervisor/supervisord.conf             </span><br><span class="line">root     16683 16581  0 19:46 pts/1    00:00:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn super</span><br><span class="line">visord                                                                                                                                                              </span><br></pre></td></tr></table></figure><p>配置修改后的重新载入，代替supervisorctl reload</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(scrapy_hub) ➜  gamble_monitor git:(master) /usr/local/python3/bin/supervisorctl -c /etc/supervisor/supervisord.conf                                                </span><br><span class="line">update_api_run                   RUNNING   pid 22136, uptime 0:09:04</span><br><span class="line">supervisor&gt; reload                                                                                                                                                  </span><br><span class="line">Really restart the remote supervisord process y/N? y</span><br><span class="line">Restarted supervisord</span><br><span class="line">supervisor&gt; help                                                                                                                                                    </span><br><span class="line"></span><br><span class="line">default commands (type help &lt;topic&gt;):</span><br><span class="line">=====================================</span><br><span class="line">add    exit      open  reload  restart   start   tail   </span><br><span class="line">avail  fg        pid   remove  shutdown  status  update </span><br><span class="line">clear  maintail  quit  reread  signal    stop    version</span><br><span class="line"></span><br><span class="line">supervisor&gt; </span><br></pre></td></tr></table></figure><hr><h2 id="分割线：下面供参考，yum方式安装是旧版本。"><a href="#分割线：下面供参考，yum方式安装是旧版本。" class="headerlink" title="分割线：下面供参考，yum方式安装是旧版本。"></a>分割线：下面供参考，yum方式安装是旧版本。</h2><h2 id="使用yum安装"><a href="#使用yum安装" class="headerlink" title="使用yum安装"></a>使用yum安装</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">yum install epel-release</span><br><span class="line">yum install supervisor</span><br><span class="line"></span><br><span class="line">systemctl enable supervisord.service # 开机自启动</span><br><span class="line">systemctl start supervisord.service # 启动supervisord服务</span><br><span class="line">systemctl status supervisord.service # 查看supervisord服务状态</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">开启web服务:修改supervisord.conf ,inet_http_server节点取消注释。</span></span><br><span class="line">vim /etc/supervisord.conf </span><br><span class="line">supervisorctl reload</span><br><span class="line">[inet_http_server]         ; inet (TCP) server disabled by default</span><br><span class="line">port=*:9001        ; (ip_address:port specifier, *:port for all iface)</span><br><span class="line">username=clark              ; (default is no username (open server))</span><br><span class="line">password=123456               ; (default is no password (open server))</span><br><span class="line"></span><br><span class="line">ps -ef|grep supervisord # 查看是否存在supervisord进程</span><br></pre></td></tr></table></figure><h2 id="应用配置"><a href="#应用配置" class="headerlink" title="应用配置"></a>应用配置</h2><p>Supervisor 管理应用的进程，需要对每个应用进行配置。在 <code>/etc/supervisord.d</code> 中创建 <code>helloworld.ini</code>，每个应用对应一个配置文件即可。<br>下面是配置文件的示例：</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[program:helloworld]</span>  <span class="comment">;程序的名称</span></span><br><span class="line"><span class="attr">command</span> = dotnet HelloWorld.dll <span class="comment">;执行的命令</span></span><br><span class="line"><span class="attr">directory</span> = /root/www/ <span class="comment">;命令执行的目录</span></span><br><span class="line"><span class="attr">environment</span> = ASPNETCORE__ENVIRONMENT=Production  <span class="comment">;环境变量</span></span><br><span class="line"><span class="attr">user</span> = root  <span class="comment">;执行进程的用户</span></span><br><span class="line"><span class="attr">stopsignal</span> = INT  </span><br><span class="line"><span class="attr">autostart</span> = <span class="literal">true</span>  <span class="comment">;是否自动启动</span></span><br><span class="line"><span class="attr">autorestart</span> = <span class="literal">true</span>  <span class="comment">;是否自动重启</span></span><br><span class="line"><span class="attr">startsecs</span> = <span class="number">1</span>  <span class="comment">;自动重启间隔</span></span><br><span class="line"><span class="attr">stderr_logfile</span> = /var/log/helloworld.err.log  <span class="comment">;标准错误日志</span></span><br><span class="line"><span class="attr">stdout_logfile</span> = /var/log/helloworld.out.log  <span class="comment">;标准输出日志</span></span><br></pre></td></tr></table></figure><p>实际项目:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">supervisor部署：</span><br><span class="line">cd /etc/supervisord.d/</span><br><span class="line"></span><br><span class="line">vim product_new_merchant.ini</span><br><span class="line"></span><br><span class="line">[program:product_new_merchant]</span><br><span class="line">user = root</span><br><span class="line">directory = /root/data_hub/all_script</span><br><span class="line">command = /root/.virtualenvs/ProductNewMerchant/bin/python3.7 product_new_merchant.py</span><br><span class="line">autostart = true</span><br><span class="line">autorestart = true</span><br><span class="line">startsecs = 1</span><br><span class="line">environment = MYSQL_HOST=&quot;192.168.6.160&quot;,MYSQL_DATABASE=&quot;xxxxx&quot;,MYSQL_USER_NAME=&quot;xxxxxx&quot;,MYSQL_PASSWORD=&quot;xxxxx&quot;,MYSQL_PORT=3306,REDIS_HOST=&quot;192.168.95.55&quot;,LANG=&quot;en_US.utf8&quot;,LC_ALL=&quot;en_US.UTF-8&quot;,LC_LANG=&quot;en_US.UTF-8&quot;</span><br><span class="line">stdout_logfile = /var/log/product_new_merchant.log</span><br><span class="line">redirect_stderr=true</span><br><span class="line">stopsignal = INT</span><br></pre></td></tr></table></figure><p>创建好配置文件后，重启 Supervisor</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl reload</span><br></pre></td></tr></table></figure><p>或热重启，不会重启其他子进程</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">supervisorctl reread</span><br><span class="line"></span><br><span class="line">supervisorctl update</span><br></pre></td></tr></table></figure><p>为确保没有错误，可以正常启动，使用前文提到的查看Supervisor状态的命令查看。或者查看要管理的进程是否启动，本例中可以使用下面的命令：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep HelloWorld.dll</span><br><span class="line"></span><br><span class="line">或</span><br><span class="line">ps -ef | grep dotnet</span><br></pre></td></tr></table></figure><h2 id="可能遇到的问题"><a href="#可能遇到的问题" class="headerlink" title="可能遇到的问题"></a>可能遇到的问题</h2><p>1、我在网页上tail的时候，要不就是一直不返回，要不就是Error response<br>Error code 410.<br>Message: Gone.</p><p>解决方法:可能是Chrome某个插件不兼容，影响到了supervisor。使用无痕模式或者换一个Safari浏览器，解决了。</p><p>2、stderr_logfile和stdout_logfile 颠倒<br>3、web界面中文乱码<br>参考：<a href="https://www.crifan.com/upgrade_centos_supervisor_to_latest_version/">https://www.crifan.com/upgrade_centos_supervisor_to_latest_version/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">3.1.4老版本，升级最新版</span><br><span class="line">[root@web-95-55 admin]# supervisord --version</span><br><span class="line">3.1.4</span><br><span class="line"></span><br><span class="line">备份yum版本supervisor配置文件，供参考:</span><br><span class="line"></span><br><span class="line">yum remove supervisor</span><br><span class="line">yum remove python-meld3</span><br><span class="line">pip install supervisor</span><br><span class="line">mkdir /etc/supervisor</span><br><span class="line">echo_supervisord_conf &gt; /etc/supervisor/supervisord.conf</span><br><span class="line">vim /etc/supervisor/supervisord.conf</span><br><span class="line"></span><br><span class="line">修改应用配置文件路径：</span><br><span class="line">;[include]</span><br><span class="line">files = /etc/supervisor/config.d/*.ini</span><br><span class="line"></span><br><span class="line">mkdir /etc/supervisor/config.d</span><br><span class="line">cd /etc/supervisor/config.d</span><br><span class="line">启动supervisor：</span><br><span class="line">supervisord -c /etc/supervisor/supervisord.conf</span><br></pre></td></tr></table></figure><h2 id="附：公司运维小哥笔记"><a href="#附：公司运维小哥笔记" class="headerlink" title="附：公司运维小哥笔记"></a>附：公司运维小哥笔记</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">yum install supervisor -y</span><br><span class="line">supervisor 配置说明</span><br><span class="line">通过这种形式安装的supervisor，其配置文件的目录位于：</span><br><span class="line">/etc/supervisord.conf (主配置文件，下面会详细介绍)</span><br><span class="line">/etc/supervisor.d/ (默认子进程配置文件，也就是需要我们根据程序配置的地方)</span><br><span class="line"></span><br><span class="line">[unix_http_server]</span><br><span class="line">file=/home/supervisor/supervisor.sock   ; supervisorctl使用的 socket文件的路径</span><br><span class="line">;chmod=0700                 ; 默认的socket文件权限0700</span><br><span class="line">;chown=nobody:nogroup       ; socket文件的拥有者</span><br><span class="line"></span><br><span class="line">[inet_http_server]         ; 提供web管理后台管理相关配置</span><br><span class="line">port=0.0.0.0:9001          ; web管理后台运行的ip地址及端口，绑定外网需考虑安全性 </span><br><span class="line">;username=root             ; web管理后台登录用户名密码</span><br><span class="line">;password=root</span><br><span class="line"></span><br><span class="line">[supervisord]</span><br><span class="line">logfile=/var/log/supervisord.log ; 日志文件，默认在$CWD/supervisord.log</span><br><span class="line">logfile_maxbytes=50MB        ; 日志限制大小，超过会生成新文件，0表示不限制</span><br><span class="line">logfile_backups=10           ; 日志备份数量默认10，0表示不备份</span><br><span class="line">loglevel=info                ; 日志级别</span><br><span class="line">pidfile=/home/supervisor/supervisord.pid ; supervisord pidfile; default supervisord.pid              ; pid文件</span><br><span class="line">nodaemon=false               ; 是否在前台启动，默认后台启动false</span><br><span class="line">minfds=1024                  ; 可以打开文件描述符最小值</span><br><span class="line">minprocs=200                 ; 可以打开的进程最小值</span><br><span class="line"></span><br><span class="line">[supervisorctl]</span><br><span class="line">serverurl=unix:///home/supervisor/supervisor.sock ; 通过socket连接supervisord,路径与unix_http_server-&gt;file配置的一致</span><br><span class="line"></span><br><span class="line">[include]</span><br><span class="line">files = supervisor.d/*.conf ;指定了在当前目录supervisor.d文件夹下配置多个配置文件</span><br><span class="line"></span><br><span class="line">定义supervisor管理进程配置文件</span><br><span class="line"></span><br><span class="line">[program:sboot] ;[program:xxx] 这里的xxx是指的项目名字</span><br><span class="line">directory = /opt/project  ;程序所在目录</span><br><span class="line">command =  java -jar springboot-hello-sample.jar ;程序启动命令</span><br><span class="line">autostart=true ;是否跟随supervisord的启动而启动</span><br><span class="line">autorestart=true; 程序退出后自动重启,可选值：[unexpected,true,false]，默认为unexpected，表示进程意外杀死后才重启</span><br><span class="line">stopasgroup=true;进程被杀死时，是否向这个进程组发送stop信号，包括子进程</span><br><span class="line">killasgroup=true;向进程组发送kill信号，包括子进程</span><br><span class="line">stdout_logfile=/var/log/sboot/supervisor.log;该程序日志输出文件，目录需要手动创建</span><br><span class="line">stdout_logfile_maxbytes = 50MB;日志大小</span><br><span class="line">stdout_logfile_backups  = 100;备份数</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">service supervisord restart</span><br><span class="line"></span><br><span class="line">直接在命令行输入supervisorctl会展示当前已配置好的项目信息。</span><br><span class="line">[root@wangzh supervisor.d]# supervisorctl </span><br><span class="line">sboot                            RUNNING   pid 27517, uptime 0:18:04</span><br><span class="line">supervisor&gt; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后可以执行</span><br><span class="line">start/stop/restart sboot 来简单控制项目的启停等</span><br><span class="line"></span><br><span class="line">supervisorctl update #更新配置文件</span><br><span class="line">supervisorctl reload #重新启动配置的程序</span><br><span class="line">supervisorctl stop all #停止全部管理进程</span><br></pre></td></tr></table></figure><h2 id="参考"><a href="#参考" class="headerlink" title="参考:"></a>参考:</h2><p>1、<a href="https://www.chengxulvtu.com/supervisor-on-centos-7/">https://www.chengxulvtu.com/supervisor-on-centos-7/</a></p><p>2、<a href="https://blog.csdn.net/DongGeGe214/article/details/80264811">https://blog.csdn.net/DongGeGe214/article/details/80264811</a></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;在Centos7使用supervisor&quot;&gt;&lt;a href=&quot;#在Centos7使用supervisor&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>在Centos7安装python3、配置zsh、虚拟环境</title>
    <link href="https://clarklu.com/p/408fe7ca.html"/>
    <id>https://clarklu.com/p/408fe7ca.html</id>
    <published>2018-07-23T07:44:21.000Z</published>
    <updated>2025-11-20T09:43:36.465Z</updated>
    
    <content type="html"><![CDATA[<h2 id="安装python3"><a href="#安装python3" class="headerlink" title="安装python3"></a>安装python3</h2><p>参考：<a href="https://www.yuzhi100.com/tutorial/centos/centos-anzhuang-python36">https://www.yuzhi100.com/tutorial/centos/centos-anzhuang-python36</a><br>CentOS7系统自带的Python版本是Python2.7，如需使用Python3.6，需要自行安装Python3.6。</p><h3 id="1-安装IUS软件源"><a href="#1-安装IUS软件源" class="headerlink" title="(1)安装IUS软件源"></a>(1)安装IUS软件源</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装EPEL依赖</span></span><br><span class="line">sudo yum install epel-release</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装IUS软件源</span></span><br><span class="line">sudo yum install https://centos7.iuscommunity.org/ius-release.rpm</span><br></pre></td></tr></table></figure><h3 id="2-安装Python3-6"><a href="#2-安装Python3-6" class="headerlink" title="(2)安装Python3.6"></a>(2)安装Python3.6</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install python36u</span><br></pre></td></tr></table></figure><p>安装Python3完成后的shell命令为python3.6，为了使用方便，创建一个到python3的符号链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">rm</span> /bin/python <span class="comment"># 删除默认的python2</span></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">sudo</span> <span class="built_in">ln</span> -s /bin/python3.6 /bin/python</span></span><br><span class="line">sudo ln -s /bin/python3.6 /bin/python3</span><br></pre></td></tr></table></figure><h3 id="3-安装pip3"><a href="#3-安装pip3" class="headerlink" title="(3)安装pip3"></a>(3)安装pip3</h3><p>安装完成python36u并没有安装pip，安&#x2F;装pip</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install python36u-pip</span><br></pre></td></tr></table></figure><p>安装pip完成后的shell命令为pip3.6，为了使用方便，创建一个到pip3的符号链接</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /bin/pip3.6 /bin/pip</span><br><span class="line">sudo ln -s /bin/pip3.6 /bin/pip3</span><br></pre></td></tr></table></figure><h3 id="4-遇到的问题"><a href="#4-遇到的问题" class="headerlink" title="(4) 遇到的问题"></a>(4) 遇到的问题</h3><p>1、使用yum命令报错File “&#x2F;usr&#x2F;bin&#x2F;yum”, line 30 except KeyboardInterrupt, e:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@10-41-140-1 ~]# yum install zsh</span><br><span class="line">  File &quot;/usr/bin/yum&quot;, line 30</span><br><span class="line">    except KeyboardInterrupt, e:</span><br><span class="line">                            ^</span><br><span class="line">SyntaxError: invalid syntax</span><br><span class="line">[root@10-41-140-1 ~]# rm /bin/python</span><br><span class="line">rm: remove symbolic link ‘/bin/python’? y</span><br><span class="line">[root@10-41-140-1 ~]# sudo ln -s /bin/python2.7 /bin/python</span><br></pre></td></tr></table></figure><p>问题出现原因：<br>yum包管理是使用python2.x写的，将python2.x升级到python3.1.3以后，由于python版本语法兼容性导致问题出现<br>解决办法： python软连接到指向python2.7<br>参考：<a href="https://blog.csdn.net/zsl10/article/details/52315319">https://blog.csdn.net/zsl10/article/details/52315319</a></p><h2 id="安装zsh"><a href="#安装zsh" class="headerlink" title="安装zsh"></a>安装zsh</h2><p>参考:<a href="https://www.jianshu.com/p/556ff130fc65">https://www.jianshu.com/p/556ff130fc65</a></p><h3 id="1-安装zsh包"><a href="#1-安装zsh包" class="headerlink" title="(1)安装zsh包"></a>(1)安装zsh包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install zsh</span><br></pre></td></tr></table></figure><h3 id="2-切换默认shell为zsh"><a href="#2-切换默认shell为zsh" class="headerlink" title="(2)切换默认shell为zsh"></a>(2)切换默认shell为zsh</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/zsh</span><br></pre></td></tr></table></figure><h3 id="3-重启终端，让修改的配置生效"><a href="#3-重启终端，让修改的配置生效" class="headerlink" title="(3)重启终端，让修改的配置生效"></a>(3)重启终端，让修改的配置生效</h3><h3 id="4-安装oh-my-zsh"><a href="#4-安装oh-my-zsh" class="headerlink" title="(4)安装oh-my-zsh"></a>(4)安装oh-my-zsh</h3><h4 id="4-1-安装git"><a href="#4-1-安装git" class="headerlink" title="4.1 安装git"></a>4.1 安装git</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install git</span><br></pre></td></tr></table></figure><h4 id="4-2-通过curl安装"><a href="#4-2-通过curl安装" class="headerlink" title="4.2 通过curl安装"></a>4.2 通过curl安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh | sh</span><br></pre></td></tr></table></figure><h4 id="4-2-或者通过wget安装"><a href="#4-2-或者通过wget安装" class="headerlink" title="4.2 或者通过wget安装"></a>4.2 或者通过wget安装</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.github.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O - | sh</span><br></pre></td></tr></table></figure><h4 id="4-3-修改oh-my-zsh主题"><a href="#4-3-修改oh-my-zsh主题" class="headerlink" title="4.3 修改oh-my-zsh主题"></a>4.3 修改oh-my-zsh主题</h4><p>查看oh my zsh主题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls ~/.oh-my-zsh/themes</span><br></pre></td></tr></table></figure><p>修改主题</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><p>可以看到默认的主题是ZSH_THEME&#x3D;”robbyrussell” 改成自己喜欢的即可.</p><p>4.4 重启终端，主题生效</p><h2 id="虚拟环境"><a href="#虚拟环境" class="headerlink" title="虚拟环境"></a>虚拟环境</h2><h3 id="1-安装virtualenv相关依赖"><a href="#1-安装virtualenv相关依赖" class="headerlink" title="(1) 安装virtualenv相关依赖"></a>(1) 安装virtualenv相关依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install virtualenv</span><br><span class="line">sudo pip install virtualenvwrapper</span><br></pre></td></tr></table></figure><h3 id="2-修改-zshrc"><a href="#2-修改-zshrc" class="headerlink" title="(2)修改 .zshrc"></a>(2)修改 .zshrc</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ where is virtualenvwrapper.sh                                                                                                       </span><br><span class="line">is not found                                                                                                                             </span><br><span class="line">/usr/bin/virtualenvwrapper.sh  </span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">复制内容,进入.zshrc  </span><br><span class="line">export VIRTUALENVWRAPPER_PYTHON=/usr/bin/python3</span><br><span class="line">export WORKON_HOME=$HOME/.virtualenvs</span><br><span class="line">source /usr/bin/virtualenvwrapper.sh</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ vim .zshrc  </span><br><span class="line">➜  ~ source .zshrc                                                                                                                       </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkproject                                                                  </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkproject                                                                 </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/initialize                                                                    </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/premkvirtualenv                                                               </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/postmkvirtualenv                                                              </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/prermvirtualenv                                                               </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/postrmvirtualenv                                                              </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/predeactivate                                                                 </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/postdeactivate                                                                </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/preactivate                                                                   </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/postactivate                                                                  </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/get_env_details                                                               </span><br><span class="line">➜  ~   </span><br></pre></td></tr></table></figure><h3 id="3-测试是否成功"><a href="#3-测试是否成功" class="headerlink" title="(3) 测试是否成功"></a>(3) 测试是否成功</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ mkvirtualenv test01 -p python3  # -p 参数指定 python 版本                                                                                                                        </span><br><span class="line">Using base prefix &#x27;/usr&#x27;                                                                                                                        </span><br><span class="line">  No LICENSE.txt / LICENSE found in source                                                                                                      </span><br><span class="line">New python executable in /root/.virtualenvs/test01/bin/python3.6                                                                                </span><br><span class="line">Also creating executable in /root/.virtualenvs/test01/bin/python                                                                                </span><br><span class="line">Installing setuptools, pip, wheel...                                                                                                            </span><br><span class="line">done.                                                                                                                                           </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/test01/bin/predeactivate                                                             </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/test01/bin/postdeactivate                                                            </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/test01/bin/preactivate                                                               </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/test01/bin/postactivate                                                              </span><br><span class="line">virtualenvwrapper.user_scripts creating /root/.virtualenvs/test01/bin/get_env_details                                                           </span><br><span class="line">(test01) ➜  ~  </span><br><span class="line">(test01) ➜  ~ deactivate                                                                                                                        </span><br><span class="line">➜  ~ workon test01                                                                                                                              </span><br><span class="line">(test01) ➜  ~    </span><br></pre></td></tr></table></figure><h3 id="4-确定下虚拟环境内，python的路径，为在supervisor配置文件里使用"><a href="#4-确定下虚拟环境内，python的路径，为在supervisor配置文件里使用" class="headerlink" title="(4)确定下虚拟环境内，python的路径，为在supervisor配置文件里使用"></a>(4)确定下虚拟环境内，python的路径，为在supervisor配置文件里使用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(test01) ➜  ~ where is python                                                                                                                   </span><br><span class="line">is not found                                                                                                                                    </span><br><span class="line">/root/.virtualenvs/test01/bin/python                                                                                                            </span><br><span class="line">/usr/bin/python                                                                                                                                 </span><br><span class="line">(test01) ➜  ~  </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h2 id=&quot;安装python3&quot;&gt;&lt;a href=&quot;#安装python3&quot; class=&quot;headerlink&quot; title=&quot;安装python3&quot;&gt;&lt;/a&gt;安装python3&lt;/h2&gt;&lt;p&gt;参考：&lt;a</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
  <entry>
    <title>生产环境CentOs7安装docker记实</title>
    <link href="https://clarklu.com/p/ad3d805f.html"/>
    <id>https://clarklu.com/p/ad3d805f.html</id>
    <published>2018-07-17T04:35:17.000Z</published>
    <updated>2025-11-20T09:43:36.467Z</updated>
    
    <content type="html"><![CDATA[<h1 id="生产环境CentOs7安装docker记实"><a href="#生产环境CentOs7安装docker记实" class="headerlink" title="生产环境CentOs7安装docker记实"></a>生产环境CentOs7安装docker记实</h1><p>记录下，下次直接C、V使用</p><h2 id="前置检查"><a href="#前置检查" class="headerlink" title="前置检查"></a>前置检查</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@web-95-61 /]# cat /etc/redhat-release                                                                                              </span><br><span class="line">CentOS Linux release 7.6.1810 (Core)                                                                                                     </span><br><span class="line">[root@web-95-61 /]# uname -a                                                                                                             </span><br><span class="line">Linux web-95-61 3.10.0-862.el7.x86_64 #1 SMP Fri Apr 20 16:44:24 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux                                 </span><br><span class="line">[root@web-95-61 /]#   </span><br></pre></td></tr></table></figure><h2 id="配置国内yum源"><a href="#配置国内yum源" class="headerlink" title="配置国内yum源"></a>配置国内yum源</h2><p>参考：<br><a href="https://blog.csdn.net/inslow/article/details/54177191">https://blog.csdn.net/inslow/article/details/54177191</a><br><a href="https://yeasy.gitbooks.io/docker_practice/install/centos.html">https://yeasy.gitbooks.io/docker_practice/install/centos.html</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[admin@web-95-61 ~]$ su                                                                                                                  </span><br><span class="line">Password:                 </span><br><span class="line">[root@web-95-61 /]# cd /etc/yum.repos.d/                                                                                                 </span><br><span class="line">[root@web-95-61 yum.repos.d]# ls                                                                                                         </span><br><span class="line">baofoo-centos-7.repo                                                                                                                     </span><br><span class="line">[root@web-95-61 yum.repos.d]#  wget http://mirrors.163.com/.help/CentOS7-Base-163.repo</span><br><span class="line">[root@web-95-61 yum.repos.d]# yum makecache</span><br><span class="line">[root@web-95-61 yum.repos.d]# yum -y update</span><br></pre></td></tr></table></figure><h2 id="安装docker"><a href="#安装docker" class="headerlink" title="安装docker"></a>安装docker</h2><p>参考：<br><a href="https://qizhanming.com/blog/2019/01/25/how-to-install-docker-ce-on-centos-7">https://qizhanming.com/blog/2019/01/25/how-to-install-docker-ce-on-centos-7</a><br><a href="https://yeasy.gitbooks.io/docker_practice/install/centos.html">https://yeasy.gitbooks.io/docker_practice/install/centos.html</a></p><h3 id="卸载旧版本"><a href="#卸载旧版本" class="headerlink" title="卸载旧版本"></a>卸载旧版本</h3><p>旧版本的 Docker 被叫做 docker 或 docker-engine，如果您安装了旧版本的 Docker ，您需要卸载掉它。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum remove docker \</span></span><br><span class="line"><span class="language-bash">                  docker-client \</span></span><br><span class="line"><span class="language-bash">                  docker-client-latest \</span></span><br><span class="line"><span class="language-bash">                  docker-common \</span></span><br><span class="line"><span class="language-bash">                  docker-latest \</span></span><br><span class="line"><span class="language-bash">                  docker-latest-logrotate \</span></span><br><span class="line"><span class="language-bash">                  docker-logrotate \</span></span><br><span class="line"><span class="language-bash">                  docker-engine</span></span><br></pre></td></tr></table></figure><p>旧版本的内容在 &#x2F;var&#x2F;lib&#x2F;docker 下，目录中的镜像(images), 容器(containers), 存储卷(volumes), 和 网络配置（networks）都可以保留。</p><p>Docker CE 包，目前的包名为 docker-ce</p><h3 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h3><p>为了方便添加软件源，支持 devicemapper 存储类型，安装如下软件包</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum install -y yum-utils \</span></span><br><span class="line"><span class="language-bash">  device-mapper-persistent-data \</span></span><br><span class="line"><span class="language-bash">  lvm2</span></span><br></pre></td></tr></table></figure><p>添加 yum 软件源</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum-config-manager \</span></span><br><span class="line"><span class="language-bash">    --add-repo \</span></span><br><span class="line"><span class="language-bash">    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方源</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">$ <span class="built_in">sudo</span> yum-config-manager \</span></span><br><span class="line"><span class="language-bash"><span class="comment">#     --add-repo \</span></span></span><br><span class="line"><span class="language-bash"><span class="comment">#     https://download.docker.com/linux/centos/docker-ce.repo</span></span></span><br></pre></td></tr></table></figure><p>(可选)如果需要测试版本的 Docker CE 请使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum-config-manager --<span class="built_in">enable</span> docker-ce-test</span></span><br></pre></td></tr></table></figure><p>如果需要每日构建版本的 Docker CE 请使用以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum-config-manager --<span class="built_in">enable</span> docker-ce-nightly</span></span><br></pre></td></tr></table></figure><h3 id="安装-Docker-CE"><a href="#安装-Docker-CE" class="headerlink" title="安装 Docker CE"></a>安装 Docker CE</h3><p>更新一下 yum 软件源的缓存，并安装 Docker。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum makecache fast</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum update</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> yum install docker-ce</span></span><br></pre></td></tr></table></figure><p>至此，Docker 已经安装完成了，Docker 服务是没有启动的，操作系统里的 docker 组被创建，但是没有用户在这个组里。<br>注意:<br>默认的 docker 组是没有用户的（也就是说需要使用 sudo 才能使用 docker 命令）。<br>您可以将用户添加到 docker 组中（此用户就可以直接使用 docker 命令了）。<br>（可选）加入 docker 用户组命令</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash"><span class="built_in">sudo</span> usermod -aG docker USER_NAME</span></span><br></pre></td></tr></table></figure><p>用户更新组信息后，重新登录系统即可生效。</p><h3 id="启动-Docker"><a href="#启动-Docker" class="headerlink" title="启动 Docker"></a>启动 Docker</h3><p>如果想添加到开机启动</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl enable docker</span><br></pre></td></tr></table></figure><p>启动 docker 服务</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl start docker</span><br></pre></td></tr></table></figure><h3 id="验证安装"><a href="#验证安装" class="headerlink" title="验证安装"></a>验证安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker run hello-world</span><br></pre></td></tr></table></figure><h2 id="使用rancker管理，成为主机"><a href="#使用rancker管理，成为主机" class="headerlink" title="使用rancker管理，成为主机"></a>使用rancker管理，成为主机</h2><p>点击添加主机:<br><img src="http://cdn.luzihang.net/15633371423726.jpg"></p><p>复制<br><img src="http://cdn.luzihang.net/15633373557446.jpg"></p><p>新机器：<br><img src="http://cdn.luzihang.net/15633375189746.jpg"></p><p>总图:<br><img src="http://cdn.luzihang.net/15633377852073.jpg"></p><h2 id="优化：Linux永久关闭swap"><a href="#优化：Linux永久关闭swap" class="headerlink" title="优化：Linux永久关闭swap"></a>优化：Linux永久关闭swap</h2><blockquote><p>什么是swap:<br><a href="https://www.cnblogs.com/kerrycode/p/5246383.html">https://www.cnblogs.com/kerrycode/p/5246383.html</a><br>Linux内核为了提高读写效率与速度，会将文件在内存中进行缓存，这部分内存就是Cache Memory(缓存内存)。即使你的程序运行结束后，Cache Memory也不会自动释放。这就会导致你在Linux系统中程序频繁读写文件后，你会发现可用物理内存变少。当系统的物理内存不够用的时候，就需要将物理内存中的一部分空间释放出来，以供当前运行的程序使用。那些被释放的空间可能来自一些很长时间没有什么操作的程序，这些被释放的空间被临时保存到Swap空间中，等到那些程序要运行时，再从Swap分区中恢复保存的数据到内存中。这样，系统总是在物理内存不够时，才进行Swap交换。</p></blockquote><p><strong>使用了docker 最好关闭swap，内存会超分，而且性能会很差。</strong></p>]]></content>
    
    
      
      
        
        
    <summary type="html">&lt;h1 id=&quot;生产环境CentOs7安装docker记实&quot;&gt;&lt;a href=&quot;#生产环境CentOs7安装docker记实&quot; class=&quot;headerlink&quot;</summary>
        
      
    
    
    
    <category term="「原创分享」" scheme="https://clarklu.com/categories/%E3%80%8C%E5%8E%9F%E5%88%9B%E5%88%86%E4%BA%AB%E3%80%8D/"/>
    
    
  </entry>
  
</feed>
